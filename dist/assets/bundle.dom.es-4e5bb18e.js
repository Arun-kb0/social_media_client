function hi(e,t){return t={exports:{}},e(t,t.exports),t.exports}var ui=wi,li=mi,pi=vi,ht=[],it=[],gi=typeof Uint8Array<"u"?Uint8Array:Array,$e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Dt=0,yi=$e.length;Dt<yi;++Dt)ht[Dt]=$e[Dt],it[$e.charCodeAt(Dt)]=Dt;it["-".charCodeAt(0)]=62;it["_".charCodeAt(0)]=63;function dn(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");r===-1&&(r=t);var n=r===t?0:4-r%4;return[r,n]}function wi(e){var t=dn(e),r=t[0],n=t[1];return(r+n)*3/4-n}function di(e,t,r){return(t+r)*3/4-r}function mi(e){var t,r=dn(e),n=r[0],a=r[1],f=new gi(di(e,n,a)),s=0,p=a>0?n-4:n,h;for(h=0;h<p;h+=4)t=it[e.charCodeAt(h)]<<18|it[e.charCodeAt(h+1)]<<12|it[e.charCodeAt(h+2)]<<6|it[e.charCodeAt(h+3)],f[s++]=t>>16&255,f[s++]=t>>8&255,f[s++]=t&255;return a===2&&(t=it[e.charCodeAt(h)]<<2|it[e.charCodeAt(h+1)]>>4,f[s++]=t&255),a===1&&(t=it[e.charCodeAt(h)]<<10|it[e.charCodeAt(h+1)]<<4|it[e.charCodeAt(h+2)]>>2,f[s++]=t>>8&255,f[s++]=t&255),f}function Ei(e){return ht[e>>18&63]+ht[e>>12&63]+ht[e>>6&63]+ht[e&63]}function _i(e,t,r){for(var n,a=[],f=t;f<r;f+=3)n=(e[f]<<16&16711680)+(e[f+1]<<8&65280)+(e[f+2]&255),a.push(Ei(n));return a.join("")}function vi(e){for(var t,r=e.length,n=r%3,a=[],f=16383,s=0,p=r-n;s<p;s+=f)a.push(_i(e,s,s+f>p?p:s+f));return n===1?(t=e[r-1],a.push(ht[t>>2]+ht[t<<4&63]+"==")):n===2&&(t=(e[r-2]<<8)+e[r-1],a.push(ht[t>>10]+ht[t>>4&63]+ht[t<<2&63]+"=")),a.join("")}var Pe={byteLength:ui,toByteArray:li,fromByteArray:pi};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var Si=function(t,r,n,a,f){var s,p,h=f*8-a-1,w=(1<<h)-1,g=w>>1,u=-7,_=n?f-1:0,T=n?-1:1,S=t[r+_];for(_+=T,s=S&(1<<-u)-1,S>>=-u,u+=h;u>0;s=s*256+t[r+_],_+=T,u-=8);for(p=s&(1<<-u)-1,s>>=-u,u+=a;u>0;p=p*256+t[r+_],_+=T,u-=8);if(s===0)s=1-g;else{if(s===w)return p?NaN:(S?-1:1)*(1/0);p=p+Math.pow(2,a),s=s-g}return(S?-1:1)*p*Math.pow(2,s-a)},Ni=function(t,r,n,a,f,s){var p,h,w,g=s*8-f-1,u=(1<<g)-1,_=u>>1,T=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,S=a?0:s-1,O=a?1:-1,j=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(h=isNaN(r)?1:0,p=u):(p=Math.floor(Math.log(r)/Math.LN2),r*(w=Math.pow(2,-p))<1&&(p--,w*=2),p+_>=1?r+=T/w:r+=T*Math.pow(2,1-_),r*w>=2&&(p++,w/=2),p+_>=u?(h=0,p=u):p+_>=1?(h=(r*w-1)*Math.pow(2,f),p=p+_):(h=r*Math.pow(2,_-1)*Math.pow(2,f),p=0));f>=8;t[n+S]=h&255,S+=O,h/=256,f-=8);for(p=p<<f|h,g+=f;g>0;t[n+S]=p&255,S+=O,p/=256,g-=8);t[n+S-O]|=j*128},Ft={read:Si,write:Ni},xe=hi(function(e,t){var r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=s,t.SlowBuffer=$,t.INSPECT_MAX_BYTES=50;var n=2147483647;t.kMaxLength=n,s.TYPED_ARRAY_SUPPORT=a(),!s.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function a(){try{var c=new Uint8Array(1),i={foo:function(){return 42}};return Object.setPrototypeOf(i,Uint8Array.prototype),Object.setPrototypeOf(c,i),c.foo()===42}catch{return!1}}Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}});function f(c){if(c>n)throw new RangeError('The value "'+c+'" is invalid for option "size"');var i=new Uint8Array(c);return Object.setPrototypeOf(i,s.prototype),i}function s(c,i,o){if(typeof c=="number"){if(typeof i=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return g(c)}return p(c,i,o)}s.poolSize=8192;function p(c,i,o){if(typeof c=="string")return u(c,i);if(ArrayBuffer.isView(c))return T(c);if(c==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(c));if(H(c,ArrayBuffer)||c&&H(c.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(H(c,SharedArrayBuffer)||c&&H(c.buffer,SharedArrayBuffer)))return S(c,i,o);if(typeof c=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var l=c.valueOf&&c.valueOf();if(l!=null&&l!==c)return s.from(l,i,o);var y=O(c);if(y)return y;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof c[Symbol.toPrimitive]=="function")return s.from(c[Symbol.toPrimitive]("string"),i,o);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(c))}s.from=function(c,i,o){return p(c,i,o)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array);function h(c){if(typeof c!="number")throw new TypeError('"size" argument must be of type number');if(c<0)throw new RangeError('The value "'+c+'" is invalid for option "size"')}function w(c,i,o){return h(c),c<=0?f(c):i!==void 0?typeof o=="string"?f(c).fill(i,o):f(c).fill(i):f(c)}s.alloc=function(c,i,o){return w(c,i,o)};function g(c){return h(c),f(c<0?0:j(c)|0)}s.allocUnsafe=function(c){return g(c)},s.allocUnsafeSlow=function(c){return g(c)};function u(c,i){if((typeof i!="string"||i==="")&&(i="utf8"),!s.isEncoding(i))throw new TypeError("Unknown encoding: "+i);var o=P(c,i)|0,l=f(o),y=l.write(c,i);return y!==o&&(l=l.slice(0,y)),l}function _(c){for(var i=c.length<0?0:j(c.length)|0,o=f(i),l=0;l<i;l+=1)o[l]=c[l]&255;return o}function T(c){if(H(c,Uint8Array)){var i=new Uint8Array(c);return S(i.buffer,i.byteOffset,i.byteLength)}return _(c)}function S(c,i,o){if(i<0||c.byteLength<i)throw new RangeError('"offset" is outside of buffer bounds');if(c.byteLength<i+(o||0))throw new RangeError('"length" is outside of buffer bounds');var l;return i===void 0&&o===void 0?l=new Uint8Array(c):o===void 0?l=new Uint8Array(c,i):l=new Uint8Array(c,i,o),Object.setPrototypeOf(l,s.prototype),l}function O(c){if(s.isBuffer(c)){var i=j(c.length)|0,o=f(i);return o.length===0||c.copy(o,0,0,i),o}if(c.length!==void 0)return typeof c.length!="number"||Lt(c.length)?f(0):_(c);if(c.type==="Buffer"&&Array.isArray(c.data))return _(c.data)}function j(c){if(c>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return c|0}function $(c){return+c!=c&&(c=0),s.alloc(+c)}s.isBuffer=function(i){return i!=null&&i._isBuffer===!0&&i!==s.prototype},s.compare=function(i,o){if(H(i,Uint8Array)&&(i=s.from(i,i.offset,i.byteLength)),H(o,Uint8Array)&&(o=s.from(o,o.offset,o.byteLength)),!s.isBuffer(i)||!s.isBuffer(o))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(i===o)return 0;for(var l=i.length,y=o.length,d=0,m=Math.min(l,y);d<m;++d)if(i[d]!==o[d]){l=i[d],y=o[d];break}return l<y?-1:y<l?1:0},s.isEncoding=function(i){switch(String(i).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(i,o){if(!Array.isArray(i))throw new TypeError('"list" argument must be an Array of Buffers');if(i.length===0)return s.alloc(0);var l;if(o===void 0)for(o=0,l=0;l<i.length;++l)o+=i[l].length;var y=s.allocUnsafe(o),d=0;for(l=0;l<i.length;++l){var m=i[l];if(H(m,Uint8Array))d+m.length>y.length?s.from(m).copy(y,d):Uint8Array.prototype.set.call(y,m,d);else if(s.isBuffer(m))m.copy(y,d);else throw new TypeError('"list" argument must be an Array of Buffers');d+=m.length}return y};function P(c,i){if(s.isBuffer(c))return c.length;if(ArrayBuffer.isView(c)||H(c,ArrayBuffer))return c.byteLength;if(typeof c!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+babelHelpers.typeof(c));var o=c.length,l=arguments.length>2&&arguments[2]===!0;if(!l&&o===0)return 0;for(var y=!1;;)switch(i){case"ascii":case"latin1":case"binary":return o;case"utf8":case"utf-8":return pt(c).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return o*2;case"hex":return o>>>1;case"base64":return k(c).length;default:if(y)return l?-1:pt(c).length;i=(""+i).toLowerCase(),y=!0}}s.byteLength=P;function Y(c,i,o){var l=!1;if((i===void 0||i<0)&&(i=0),i>this.length||((o===void 0||o>this.length)&&(o=this.length),o<=0)||(o>>>=0,i>>>=0,o<=i))return"";for(c||(c="utf8");;)switch(c){case"hex":return Z(this,i,o);case"utf8":case"utf-8":return A(this,i,o);case"ascii":return x(this,i,o);case"latin1":case"binary":return b(this,i,o);case"base64":return L(this,i,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,i,o);default:if(l)throw new TypeError("Unknown encoding: "+c);c=(c+"").toLowerCase(),l=!0}}s.prototype._isBuffer=!0;function N(c,i,o){var l=c[i];c[i]=c[o],c[o]=l}s.prototype.swap16=function(){var i=this.length;if(i%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var o=0;o<i;o+=2)N(this,o,o+1);return this},s.prototype.swap32=function(){var i=this.length;if(i%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var o=0;o<i;o+=4)N(this,o,o+3),N(this,o+1,o+2);return this},s.prototype.swap64=function(){var i=this.length;if(i%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var o=0;o<i;o+=8)N(this,o,o+7),N(this,o+1,o+6),N(this,o+2,o+5),N(this,o+3,o+4);return this},s.prototype.toString=function(){var i=this.length;return i===0?"":arguments.length===0?A(this,0,i):Y.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(i){if(!s.isBuffer(i))throw new TypeError("Argument must be a Buffer");return this===i?!0:s.compare(this,i)===0},s.prototype.inspect=function(){var i="",o=t.INSPECT_MAX_BYTES;return i=this.toString("hex",0,o).replace(/(.{2})/g,"$1 ").trim(),this.length>o&&(i+=" ... "),"<Buffer "+i+">"},r&&(s.prototype[r]=s.prototype.inspect),s.prototype.compare=function(i,o,l,y,d){if(H(i,Uint8Array)&&(i=s.from(i,i.offset,i.byteLength)),!s.isBuffer(i))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+babelHelpers.typeof(i));if(o===void 0&&(o=0),l===void 0&&(l=i?i.length:0),y===void 0&&(y=0),d===void 0&&(d=this.length),o<0||l>i.length||y<0||d>this.length)throw new RangeError("out of range index");if(y>=d&&o>=l)return 0;if(y>=d)return-1;if(o>=l)return 1;if(o>>>=0,l>>>=0,y>>>=0,d>>>=0,this===i)return 0;for(var m=d-y,U=l-o,D=Math.min(m,U),M=this.slice(y,d),q=i.slice(o,l),C=0;C<D;++C)if(M[C]!==q[C]){m=M[C],U=q[C];break}return m<U?-1:U<m?1:0};function Q(c,i,o,l,y){if(c.length===0)return-1;if(typeof o=="string"?(l=o,o=0):o>2147483647?o=2147483647:o<-2147483648&&(o=-2147483648),o=+o,Lt(o)&&(o=y?0:c.length-1),o<0&&(o=c.length+o),o>=c.length){if(y)return-1;o=c.length-1}else if(o<0)if(y)o=0;else return-1;if(typeof i=="string"&&(i=s.from(i,l)),s.isBuffer(i))return i.length===0?-1:tt(c,i,o,l,y);if(typeof i=="number")return i=i&255,typeof Uint8Array.prototype.indexOf=="function"?y?Uint8Array.prototype.indexOf.call(c,i,o):Uint8Array.prototype.lastIndexOf.call(c,i,o):tt(c,[i],o,l,y);throw new TypeError("val must be string, number or Buffer")}function tt(c,i,o,l,y){var d=1,m=c.length,U=i.length;if(l!==void 0&&(l=String(l).toLowerCase(),l==="ucs2"||l==="ucs-2"||l==="utf16le"||l==="utf-16le")){if(c.length<2||i.length<2)return-1;d=2,m/=2,U/=2,o/=2}function D(Mr,$r){return d===1?Mr[$r]:Mr.readUInt16BE($r*d)}var M;if(y){var q=-1;for(M=o;M<m;M++)if(D(c,M)===D(i,q===-1?0:M-q)){if(q===-1&&(q=M),M-q+1===U)return q*d}else q!==-1&&(M-=M-q),q=-1}else for(o+U>m&&(o=m-U),M=o;M>=0;M--){for(var C=!0,ye=0;ye<U;ye++)if(D(c,M+ye)!==D(i,ye)){C=!1;break}if(C)return M}return-1}s.prototype.includes=function(i,o,l){return this.indexOf(i,o,l)!==-1},s.prototype.indexOf=function(i,o,l){return Q(this,i,o,l,!0)},s.prototype.lastIndexOf=function(i,o,l){return Q(this,i,o,l,!1)};function W(c,i,o,l){o=Number(o)||0;var y=c.length-o;l?(l=Number(l),l>y&&(l=y)):l=y;var d=i.length;l>d/2&&(l=d/2);for(var m=0;m<l;++m){var U=parseInt(i.substr(m*2,2),16);if(Lt(U))return m;c[o+m]=U}return m}function Xt(c,i,o,l){return gt(pt(i,c.length-o),c,o,l)}function St(c,i,o,l){return gt(ge(i),c,o,l)}function Nt(c,i,o,l){return gt(k(i),c,o,l)}function Ot(c,i,o,l){return gt(Ut(i,c.length-o),c,o,l)}s.prototype.write=function(i,o,l,y){if(o===void 0)y="utf8",l=this.length,o=0;else if(l===void 0&&typeof o=="string")y=o,l=this.length,o=0;else if(isFinite(o))o=o>>>0,isFinite(l)?(l=l>>>0,y===void 0&&(y="utf8")):(y=l,l=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var d=this.length-o;if((l===void 0||l>d)&&(l=d),i.length>0&&(l<0||o<0)||o>this.length)throw new RangeError("Attempt to write outside buffer bounds");y||(y="utf8");for(var m=!1;;)switch(y){case"hex":return W(this,i,o,l);case"utf8":case"utf-8":return Xt(this,i,o,l);case"ascii":case"latin1":case"binary":return St(this,i,o,l);case"base64":return Nt(this,i,o,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ot(this,i,o,l);default:if(m)throw new TypeError("Unknown encoding: "+y);y=(""+y).toLowerCase(),m=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function L(c,i,o){return i===0&&o===c.length?Pe.fromByteArray(c):Pe.fromByteArray(c.slice(i,o))}function A(c,i,o){o=Math.min(c.length,o);for(var l=[],y=i;y<o;){var d=c[y],m=null,U=d>239?4:d>223?3:d>191?2:1;if(y+U<=o){var D,M,q,C;switch(U){case 1:d<128&&(m=d);break;case 2:D=c[y+1],(D&192)===128&&(C=(d&31)<<6|D&63,C>127&&(m=C));break;case 3:D=c[y+1],M=c[y+2],(D&192)===128&&(M&192)===128&&(C=(d&15)<<12|(D&63)<<6|M&63,C>2047&&(C<55296||C>57343)&&(m=C));break;case 4:D=c[y+1],M=c[y+2],q=c[y+3],(D&192)===128&&(M&192)===128&&(q&192)===128&&(C=(d&15)<<18|(D&63)<<12|(M&63)<<6|q&63,C>65535&&C<1114112&&(m=C))}}m===null?(m=65533,U=1):m>65535&&(m-=65536,l.push(m>>>10&1023|55296),m=56320|m&1023),l.push(m),y+=U}return rt(l)}var z=4096;function rt(c){var i=c.length;if(i<=z)return String.fromCharCode.apply(String,c);for(var o="",l=0;l<i;)o+=String.fromCharCode.apply(String,c.slice(l,l+=z));return o}function x(c,i,o){var l="";o=Math.min(c.length,o);for(var y=i;y<o;++y)l+=String.fromCharCode(c[y]&127);return l}function b(c,i,o){var l="";o=Math.min(c.length,o);for(var y=i;y<o;++y)l+=String.fromCharCode(c[y]);return l}function Z(c,i,o){var l=c.length;(!i||i<0)&&(i=0),(!o||o<0||o>l)&&(o=l);for(var y="",d=i;d<o;++d)y+=qt[c[d]];return y}function R(c,i,o){for(var l=c.slice(i,o),y="",d=0;d<l.length-1;d+=2)y+=String.fromCharCode(l[d]+l[d+1]*256);return y}s.prototype.slice=function(i,o){var l=this.length;i=~~i,o=o===void 0?l:~~o,i<0?(i+=l,i<0&&(i=0)):i>l&&(i=l),o<0?(o+=l,o<0&&(o=0)):o>l&&(o=l),o<i&&(o=i);var y=this.subarray(i,o);return Object.setPrototypeOf(y,s.prototype),y};function I(c,i,o){if(c%1!==0||c<0)throw new RangeError("offset is not uint");if(c+i>o)throw new RangeError("Trying to access beyond buffer length")}s.prototype.readUintLE=s.prototype.readUIntLE=function(i,o,l){i=i>>>0,o=o>>>0,l||I(i,o,this.length);for(var y=this[i],d=1,m=0;++m<o&&(d*=256);)y+=this[i+m]*d;return y},s.prototype.readUintBE=s.prototype.readUIntBE=function(i,o,l){i=i>>>0,o=o>>>0,l||I(i,o,this.length);for(var y=this[i+--o],d=1;o>0&&(d*=256);)y+=this[i+--o]*d;return y},s.prototype.readUint8=s.prototype.readUInt8=function(i,o){return i=i>>>0,o||I(i,1,this.length),this[i]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(i,o){return i=i>>>0,o||I(i,2,this.length),this[i]|this[i+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(i,o){return i=i>>>0,o||I(i,2,this.length),this[i]<<8|this[i+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(i,o){return i=i>>>0,o||I(i,4,this.length),(this[i]|this[i+1]<<8|this[i+2]<<16)+this[i+3]*16777216},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(i,o){return i=i>>>0,o||I(i,4,this.length),this[i]*16777216+(this[i+1]<<16|this[i+2]<<8|this[i+3])},s.prototype.readIntLE=function(i,o,l){i=i>>>0,o=o>>>0,l||I(i,o,this.length);for(var y=this[i],d=1,m=0;++m<o&&(d*=256);)y+=this[i+m]*d;return d*=128,y>=d&&(y-=Math.pow(2,8*o)),y},s.prototype.readIntBE=function(i,o,l){i=i>>>0,o=o>>>0,l||I(i,o,this.length);for(var y=o,d=1,m=this[i+--y];y>0&&(d*=256);)m+=this[i+--y]*d;return d*=128,m>=d&&(m-=Math.pow(2,8*o)),m},s.prototype.readInt8=function(i,o){return i=i>>>0,o||I(i,1,this.length),this[i]&128?(255-this[i]+1)*-1:this[i]},s.prototype.readInt16LE=function(i,o){i=i>>>0,o||I(i,2,this.length);var l=this[i]|this[i+1]<<8;return l&32768?l|4294901760:l},s.prototype.readInt16BE=function(i,o){i=i>>>0,o||I(i,2,this.length);var l=this[i+1]|this[i]<<8;return l&32768?l|4294901760:l},s.prototype.readInt32LE=function(i,o){return i=i>>>0,o||I(i,4,this.length),this[i]|this[i+1]<<8|this[i+2]<<16|this[i+3]<<24},s.prototype.readInt32BE=function(i,o){return i=i>>>0,o||I(i,4,this.length),this[i]<<24|this[i+1]<<16|this[i+2]<<8|this[i+3]},s.prototype.readFloatLE=function(i,o){return i=i>>>0,o||I(i,4,this.length),Ft.read(this,i,!0,23,4)},s.prototype.readFloatBE=function(i,o){return i=i>>>0,o||I(i,4,this.length),Ft.read(this,i,!1,23,4)},s.prototype.readDoubleLE=function(i,o){return i=i>>>0,o||I(i,8,this.length),Ft.read(this,i,!0,52,8)},s.prototype.readDoubleBE=function(i,o){return i=i>>>0,o||I(i,8,this.length),Ft.read(this,i,!1,52,8)};function J(c,i,o,l,y,d){if(!s.isBuffer(c))throw new TypeError('"buffer" argument must be a Buffer instance');if(i>y||i<d)throw new RangeError('"value" argument is out of bounds');if(o+l>c.length)throw new RangeError("Index out of range")}s.prototype.writeUintLE=s.prototype.writeUIntLE=function(i,o,l,y){if(i=+i,o=o>>>0,l=l>>>0,!y){var d=Math.pow(2,8*l)-1;J(this,i,o,l,d,0)}var m=1,U=0;for(this[o]=i&255;++U<l&&(m*=256);)this[o+U]=i/m&255;return o+l},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(i,o,l,y){if(i=+i,o=o>>>0,l=l>>>0,!y){var d=Math.pow(2,8*l)-1;J(this,i,o,l,d,0)}var m=l-1,U=1;for(this[o+m]=i&255;--m>=0&&(U*=256);)this[o+m]=i/U&255;return o+l},s.prototype.writeUint8=s.prototype.writeUInt8=function(i,o,l){return i=+i,o=o>>>0,l||J(this,i,o,1,255,0),this[o]=i&255,o+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(i,o,l){return i=+i,o=o>>>0,l||J(this,i,o,2,65535,0),this[o]=i&255,this[o+1]=i>>>8,o+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(i,o,l){return i=+i,o=o>>>0,l||J(this,i,o,2,65535,0),this[o]=i>>>8,this[o+1]=i&255,o+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(i,o,l){return i=+i,o=o>>>0,l||J(this,i,o,4,4294967295,0),this[o+3]=i>>>24,this[o+2]=i>>>16,this[o+1]=i>>>8,this[o]=i&255,o+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(i,o,l){return i=+i,o=o>>>0,l||J(this,i,o,4,4294967295,0),this[o]=i>>>24,this[o+1]=i>>>16,this[o+2]=i>>>8,this[o+3]=i&255,o+4},s.prototype.writeIntLE=function(i,o,l,y){if(i=+i,o=o>>>0,!y){var d=Math.pow(2,8*l-1);J(this,i,o,l,d-1,-d)}var m=0,U=1,D=0;for(this[o]=i&255;++m<l&&(U*=256);)i<0&&D===0&&this[o+m-1]!==0&&(D=1),this[o+m]=(i/U>>0)-D&255;return o+l},s.prototype.writeIntBE=function(i,o,l,y){if(i=+i,o=o>>>0,!y){var d=Math.pow(2,8*l-1);J(this,i,o,l,d-1,-d)}var m=l-1,U=1,D=0;for(this[o+m]=i&255;--m>=0&&(U*=256);)i<0&&D===0&&this[o+m+1]!==0&&(D=1),this[o+m]=(i/U>>0)-D&255;return o+l},s.prototype.writeInt8=function(i,o,l){return i=+i,o=o>>>0,l||J(this,i,o,1,127,-128),i<0&&(i=255+i+1),this[o]=i&255,o+1},s.prototype.writeInt16LE=function(i,o,l){return i=+i,o=o>>>0,l||J(this,i,o,2,32767,-32768),this[o]=i&255,this[o+1]=i>>>8,o+2},s.prototype.writeInt16BE=function(i,o,l){return i=+i,o=o>>>0,l||J(this,i,o,2,32767,-32768),this[o]=i>>>8,this[o+1]=i&255,o+2},s.prototype.writeInt32LE=function(i,o,l){return i=+i,o=o>>>0,l||J(this,i,o,4,2147483647,-2147483648),this[o]=i&255,this[o+1]=i>>>8,this[o+2]=i>>>16,this[o+3]=i>>>24,o+4},s.prototype.writeInt32BE=function(i,o,l){return i=+i,o=o>>>0,l||J(this,i,o,4,2147483647,-2147483648),i<0&&(i=4294967295+i+1),this[o]=i>>>24,this[o+1]=i>>>16,this[o+2]=i>>>8,this[o+3]=i&255,o+4};function et(c,i,o,l,y,d){if(o+l>c.length)throw new RangeError("Index out of range");if(o<0)throw new RangeError("Index out of range")}function Zt(c,i,o,l,y){return i=+i,o=o>>>0,y||et(c,i,o,4),Ft.write(c,i,o,l,23,4),o+4}s.prototype.writeFloatLE=function(i,o,l){return Zt(this,i,o,!0,l)},s.prototype.writeFloatBE=function(i,o,l){return Zt(this,i,o,!1,l)};function lt(c,i,o,l,y){return i=+i,o=o>>>0,y||et(c,i,o,8),Ft.write(c,i,o,l,52,8),o+8}s.prototype.writeDoubleLE=function(i,o,l){return lt(this,i,o,!0,l)},s.prototype.writeDoubleBE=function(i,o,l){return lt(this,i,o,!1,l)},s.prototype.copy=function(i,o,l,y){if(!s.isBuffer(i))throw new TypeError("argument should be a Buffer");if(l||(l=0),!y&&y!==0&&(y=this.length),o>=i.length&&(o=i.length),o||(o=0),y>0&&y<l&&(y=l),y===l||i.length===0||this.length===0)return 0;if(o<0)throw new RangeError("targetStart out of bounds");if(l<0||l>=this.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("sourceEnd out of bounds");y>this.length&&(y=this.length),i.length-o<y-l&&(y=i.length-o+l);var d=y-l;return this===i&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(o,l,y):Uint8Array.prototype.set.call(i,this.subarray(l,y),o),d},s.prototype.fill=function(i,o,l,y){if(typeof i=="string"){if(typeof o=="string"?(y=o,o=0,l=this.length):typeof l=="string"&&(y=l,l=this.length),y!==void 0&&typeof y!="string")throw new TypeError("encoding must be a string");if(typeof y=="string"&&!s.isEncoding(y))throw new TypeError("Unknown encoding: "+y);if(i.length===1){var d=i.charCodeAt(0);(y==="utf8"&&d<128||y==="latin1")&&(i=d)}}else typeof i=="number"?i=i&255:typeof i=="boolean"&&(i=Number(i));if(o<0||this.length<o||this.length<l)throw new RangeError("Out of range index");if(l<=o)return this;o=o>>>0,l=l===void 0?this.length:l>>>0,i||(i=0);var m;if(typeof i=="number")for(m=o;m<l;++m)this[m]=i;else{var U=s.isBuffer(i)?i:s.from(i,y),D=U.length;if(D===0)throw new TypeError('The value "'+i+'" is invalid for argument "value"');for(m=0;m<l-o;++m)this[m+o]=U[m%D]}return this};var Me=/[^+/0-9A-Za-z-_]/g;function pe(c){if(c=c.split("=")[0],c=c.trim().replace(Me,""),c.length<2)return"";for(;c.length%4!==0;)c=c+"=";return c}function pt(c,i){i=i||1/0;for(var o,l=c.length,y=null,d=[],m=0;m<l;++m){if(o=c.charCodeAt(m),o>55295&&o<57344){if(!y){if(o>56319){(i-=3)>-1&&d.push(239,191,189);continue}else if(m+1===l){(i-=3)>-1&&d.push(239,191,189);continue}y=o;continue}if(o<56320){(i-=3)>-1&&d.push(239,191,189),y=o;continue}o=(y-55296<<10|o-56320)+65536}else y&&(i-=3)>-1&&d.push(239,191,189);if(y=null,o<128){if((i-=1)<0)break;d.push(o)}else if(o<2048){if((i-=2)<0)break;d.push(o>>6|192,o&63|128)}else if(o<65536){if((i-=3)<0)break;d.push(o>>12|224,o>>6&63|128,o&63|128)}else if(o<1114112){if((i-=4)<0)break;d.push(o>>18|240,o>>12&63|128,o>>6&63|128,o&63|128)}else throw new Error("Invalid code point")}return d}function ge(c){for(var i=[],o=0;o<c.length;++o)i.push(c.charCodeAt(o)&255);return i}function Ut(c,i){for(var o,l,y,d=[],m=0;m<c.length&&!((i-=2)<0);++m)o=c.charCodeAt(m),l=o>>8,y=o%256,d.push(y),d.push(l);return d}function k(c){return Pe.toByteArray(pe(c))}function gt(c,i,o,l){for(var y=0;y<l&&!(y+o>=i.length||y>=c.length);++y)i[y+o]=c[y];return y}function H(c,i){return c instanceof i||c!=null&&c.constructor!=null&&c.constructor.name!=null&&c.constructor.name===i.name}function Lt(c){return c!==c}var qt=function(){for(var c="0123456789abcdef",i=new Array(256),o=0;o<16;++o)for(var l=o*16,y=0;y<16;++y)i[l+y]=c[o]+c[y];return i}()}),E=xe.Buffer;xe.SlowBuffer;xe.INSPECT_MAX_BYTES;xe.kMaxLength;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var pr=function(t,r){return pr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var f in a)a.hasOwnProperty(f)&&(n[f]=a[f])},pr(t,r)};function Ie(e,t){pr(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var $t=function(){return $t=Object.assign||function(r){for(var n,a=1,f=arguments.length;a<f;a++){n=arguments[a];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=n[s])}return r},$t.apply(this,arguments)},B=function(e){Ie(t,e);function t(r){var n=e.call(this,r)||this;return Object.setPrototypeOf(n,t.prototype),n}return Object.defineProperty(t.prototype,"name",{get:function(){return"BSONError"},enumerable:!1,configurable:!0}),t}(Error),F=function(e){Ie(t,e);function t(r){var n=e.call(this,r)||this;return Object.setPrototypeOf(n,t.prototype),n}return Object.defineProperty(t.prototype,"name",{get:function(){return"BSONTypeError"},enumerable:!1,configurable:!0}),t}(TypeError);function we(e){return e&&e.Math==Math&&e}function mn(){return we(typeof globalThis=="object"&&globalThis)||we(typeof window=="object"&&window)||we(typeof self=="object"&&self)||we(typeof global=="object"&&global)||Function("return this")()}function gr(e){return e.toString().replace("function(","function (")}function Oi(){var e=mn();return typeof e.navigator=="object"&&e.navigator.product==="ReactNative"}var bi=function(t){var r=Oi()?"BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.":"BSON: No cryptographic implementation for random bytes present, falling back to a less secure implementation.";console.warn(r);for(var n=E.alloc(t),a=0;a<t;++a)n[a]=Math.floor(Math.random()*256);return n},Ai=function(){{if(typeof window<"u"){var e=window.crypto||window.msCrypto;if(e&&e.getRandomValues)return function(t){return e.getRandomValues(E.alloc(t))}}return typeof global<"u"&&global.crypto&&global.crypto.getRandomValues?function(t){return global.crypto.getRandomValues(E.alloc(t))}:bi}},En=Ai();function _n(e){return["[object ArrayBuffer]","[object SharedArrayBuffer]"].includes(Object.prototype.toString.call(e))}function Bt(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}function Bi(e){return Object.prototype.toString.call(e)==="[object BigInt64Array]"}function Ti(e){return Object.prototype.toString.call(e)==="[object BigUint64Array]"}function kt(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function xi(e){return Object.prototype.toString.call(e)==="[object Map]"}function re(e){return he(e)&&Object.prototype.toString.call(e)==="[object Date]"}function he(e){return typeof e=="object"&&e!==null}function Re(e,t){var r=!1;function n(){for(var a=[],f=0;f<arguments.length;f++)a[f]=arguments[f];return r||(console.warn(t),r=!0),e.apply(this,a)}return n}function xt(e){if(ArrayBuffer.isView(e))return E.from(e.buffer,e.byteOffset,e.byteLength);if(_n(e))return E.from(e);throw new F("Must use either Buffer or TypedArray")}var Ii=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{12}4[0-9a-f]{3}[89ab][0-9a-f]{15})$/i,vn=function(e){return typeof e=="string"&&Ii.test(e)},yr=function(e){if(!vn(e))throw new F('UUID string representations must be a 32 or 36 character hex string (dashes excluded/included). Format: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" or "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".');var t=e.replace(/-/g,"");return E.from(t,"hex")},Pr=function(e,t){return t===void 0&&(t=!0),t?e.toString("hex",0,4)+"-"+e.toString("hex",4,6)+"-"+e.toString("hex",6,8)+"-"+e.toString("hex",8,10)+"-"+e.toString("hex",10,16):e.toString("hex")},vr=2147483647,Sr=-2147483648,Ri=Math.pow(2,63)-1,Ui=-Math.pow(2,63),Sn=Math.pow(2,53),Nn=-Math.pow(2,53),ie=1,Nr=2,Ue=3,Or=4,Le=5,On=6,br=7,Ar=8,Br=9,De=10,oe=11,bn=12,Fe=13,Tr=14,xr=15,se=16,Ir=17,Rr=18,Ur=19,Lr=255,Dr=127,An=0,Li=1,Di=2,Fi=3,ae=4,ji=5,Mi=6,$i=7,Pi=128,X=function(){function e(t,r){if(!(this instanceof e))return new e(t,r);if(t!=null&&typeof t!="string"&&!ArrayBuffer.isView(t)&&!(t instanceof ArrayBuffer)&&!Array.isArray(t))throw new F("Binary can only be constructed from string, Buffer, TypedArray, or Array<number>");this.sub_type=r??e.BSON_BINARY_SUBTYPE_DEFAULT,t==null?(this.buffer=E.alloc(e.BUFFER_SIZE),this.position=0):(typeof t=="string"?this.buffer=E.from(t,"binary"):Array.isArray(t)?this.buffer=E.from(t):this.buffer=xt(t),this.position=this.buffer.byteLength)}return e.prototype.put=function(t){if(typeof t=="string"&&t.length!==1)throw new F("only accepts single character String");if(typeof t!="number"&&t.length!==1)throw new F("only accepts single character Uint8Array or Array");var r;if(typeof t=="string"?r=t.charCodeAt(0):typeof t=="number"?r=t:r=t[0],r<0||r>255)throw new F("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.length>this.position)this.buffer[this.position++]=r;else{var n=E.alloc(e.BUFFER_SIZE+this.buffer.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n,this.buffer[this.position++]=r}},e.prototype.write=function(t,r){if(r=typeof r=="number"?r:this.position,this.buffer.length<r+t.length){var n=E.alloc(this.buffer.length+t.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n}ArrayBuffer.isView(t)?(this.buffer.set(xt(t),r),this.position=r+t.byteLength>this.position?r+t.length:this.position):typeof t=="string"&&(this.buffer.write(t,r,t.length,"binary"),this.position=r+t.length>this.position?r+t.length:this.position)},e.prototype.read=function(t,r){return r=r&&r>0?r:this.position,this.buffer.slice(t,t+r)},e.prototype.value=function(t){return t=!!t,t&&this.buffer.length===this.position?this.buffer:t?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position)},e.prototype.length=function(){return this.position},e.prototype.toJSON=function(){return this.buffer.toString("base64")},e.prototype.toString=function(t){return this.buffer.toString(t)},e.prototype.toExtendedJSON=function(t){t=t||{};var r=this.buffer.toString("base64"),n=Number(this.sub_type).toString(16);return t.legacy?{$binary:r,$type:n.length===1?"0"+n:n}:{$binary:{base64:r,subType:n.length===1?"0"+n:n}}},e.prototype.toUUID=function(){if(this.sub_type===e.SUBTYPE_UUID)return new Oe(this.buffer.slice(0,this.position));throw new B('Binary sub_type "'.concat(this.sub_type,'" is not supported for converting to UUID. Only "').concat(e.SUBTYPE_UUID,'" is currently supported.'))},e.fromExtendedJSON=function(t,r){r=r||{};var n,a;if("$binary"in t?r.legacy&&typeof t.$binary=="string"&&"$type"in t?(a=t.$type?parseInt(t.$type,16):0,n=E.from(t.$binary,"base64")):typeof t.$binary!="string"&&(a=t.$binary.subType?parseInt(t.$binary.subType,16):0,n=E.from(t.$binary.base64,"base64")):"$uuid"in t&&(a=4,n=yr(t.$uuid)),!n)throw new F("Unexpected Binary Extended JSON format ".concat(JSON.stringify(t)));return a===ae?new Oe(n):new e(n,a)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var t=this.value(!0);return'new Binary(Buffer.from("'.concat(t.toString("hex"),'", "hex"), ').concat(this.sub_type,")")},e.BSON_BINARY_SUBTYPE_DEFAULT=0,e.BUFFER_SIZE=256,e.SUBTYPE_DEFAULT=0,e.SUBTYPE_FUNCTION=1,e.SUBTYPE_BYTE_ARRAY=2,e.SUBTYPE_UUID_OLD=3,e.SUBTYPE_UUID=4,e.SUBTYPE_MD5=5,e.SUBTYPE_ENCRYPTED=6,e.SUBTYPE_COLUMN=7,e.SUBTYPE_USER_DEFINED=128,e}();Object.defineProperty(X.prototype,"_bsontype",{value:"Binary"});var Ce=16,Oe=function(e){Ie(t,e);function t(r){var n=this,a,f;if(r==null)a=t.generate();else if(r instanceof t)a=E.from(r.buffer),f=r.__id;else if(ArrayBuffer.isView(r)&&r.byteLength===Ce)a=xt(r);else if(typeof r=="string")a=yr(r);else throw new F("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");return n=e.call(this,a,ae)||this,n.__id=f,n}return Object.defineProperty(t.prototype,"id",{get:function(){return this.buffer},set:function(r){this.buffer=r,t.cacheHexString&&(this.__id=Pr(r))},enumerable:!1,configurable:!0}),t.prototype.toHexString=function(r){if(r===void 0&&(r=!0),t.cacheHexString&&this.__id)return this.__id;var n=Pr(this.id,r);return t.cacheHexString&&(this.__id=n),n},t.prototype.toString=function(r){return r?this.id.toString(r):this.toHexString()},t.prototype.toJSON=function(){return this.toHexString()},t.prototype.equals=function(r){if(!r)return!1;if(r instanceof t)return r.id.equals(this.id);try{return new t(r).id.equals(this.id)}catch{return!1}},t.prototype.toBinary=function(){return new X(this.id,X.SUBTYPE_UUID)},t.generate=function(){var r=En(Ce);return r[6]=r[6]&15|64,r[8]=r[8]&63|128,E.from(r)},t.isValid=function(r){return r?r instanceof t?!0:typeof r=="string"?vn(r):Bt(r)?r.length!==Ce?!1:(r[6]&240)===64&&(r[8]&128)===128:!1:!1},t.createFromHexString=function(r){var n=yr(r);return new t(n)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new UUID("'.concat(this.toHexString(),'")')},t}(X),_t=function(){function e(t,r){if(!(this instanceof e))return new e(t,r);this.code=t,this.scope=r}return e.prototype.toJSON=function(){return{code:this.code,scope:this.scope}},e.prototype.toExtendedJSON=function(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}},e.fromExtendedJSON=function(t){return new e(t.$code,t.$scope)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var t=this.toJSON();return'new Code("'.concat(String(t.code),'"').concat(t.scope?", ".concat(JSON.stringify(t.scope)):"",")")},e}();Object.defineProperty(_t.prototype,"_bsontype",{value:"Code"});function Bn(e){return he(e)&&e.$id!=null&&typeof e.$ref=="string"&&(e.$db==null||typeof e.$db=="string")}var yt=function(){function e(t,r,n,a){if(!(this instanceof e))return new e(t,r,n,a);var f=t.split(".");f.length===2&&(n=f.shift(),t=f.shift()),this.collection=t,this.oid=r,this.db=n,this.fields=a||{}}return Object.defineProperty(e.prototype,"namespace",{get:function(){return this.collection},set:function(t){this.collection=t},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){var t=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return this.db!=null&&(t.$db=this.db),t},e.prototype.toExtendedJSON=function(t){t=t||{};var r={$ref:this.collection,$id:this.oid};return t.legacy||(this.db&&(r.$db=this.db),r=Object.assign(r,this.fields)),r},e.fromExtendedJSON=function(t){var r=Object.assign({},t);return delete r.$ref,delete r.$id,delete r.$db,new e(t.$ref,t.$id,t.$db,r)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var t=this.oid===void 0||this.oid.toString===void 0?this.oid:this.oid.toString();return'new DBRef("'.concat(this.namespace,'", new ObjectId("').concat(String(t),'")').concat(this.db?', "'.concat(this.db,'"'):"",")")},e}();Object.defineProperty(yt.prototype,"_bsontype",{value:"DBRef"});var nt=void 0;try{nt=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}var Cr=65536,Ci=1<<24,Pt=Cr*Cr,Tn=Pt*Pt,kr=Tn/2,Wr={},Jr={},v=function(){function e(t,r,n){if(t===void 0&&(t=0),!(this instanceof e))return new e(t,r,n);typeof t=="bigint"?Object.assign(this,e.fromBigInt(t,!!r)):typeof t=="string"?Object.assign(this,e.fromString(t,!!r)):(this.low=t|0,this.high=r|0,this.unsigned=!!n),Object.defineProperty(this,"__isLong__",{value:!0,configurable:!1,writable:!1,enumerable:!1})}return e.fromBits=function(t,r,n){return new e(t,r,n)},e.fromInt=function(t,r){var n,a,f;return r?(t>>>=0,(f=0<=t&&t<256)&&(a=Jr[t],a)?a:(n=e.fromBits(t,(t|0)<0?-1:0,!0),f&&(Jr[t]=n),n)):(t|=0,(f=-128<=t&&t<128)&&(a=Wr[t],a)?a:(n=e.fromBits(t,t<0?-1:0,!1),f&&(Wr[t]=n),n))},e.fromNumber=function(t,r){if(isNaN(t))return r?e.UZERO:e.ZERO;if(r){if(t<0)return e.UZERO;if(t>=Tn)return e.MAX_UNSIGNED_VALUE}else{if(t<=-kr)return e.MIN_VALUE;if(t+1>=kr)return e.MAX_VALUE}return t<0?e.fromNumber(-t,r).neg():e.fromBits(t%Pt|0,t/Pt|0,r)},e.fromBigInt=function(t,r){return e.fromString(t.toString(),r)},e.fromString=function(t,r,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e.ZERO;if(typeof r=="number"?(n=r,r=!1):r=!!r,n=n||10,n<2||36<n)throw RangeError("radix");var a;if((a=t.indexOf("-"))>0)throw Error("interior hyphen");if(a===0)return e.fromString(t.substring(1),r,n).neg();for(var f=e.fromNumber(Math.pow(n,8)),s=e.ZERO,p=0;p<t.length;p+=8){var h=Math.min(8,t.length-p),w=parseInt(t.substring(p,p+h),n);if(h<8){var g=e.fromNumber(Math.pow(n,h));s=s.mul(g).add(e.fromNumber(w))}else s=s.mul(f),s=s.add(e.fromNumber(w))}return s.unsigned=r,s},e.fromBytes=function(t,r,n){return n?e.fromBytesLE(t,r):e.fromBytesBE(t,r)},e.fromBytesLE=function(t,r){return new e(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,r)},e.fromBytesBE=function(t,r){return new e(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],r)},e.isLong=function(t){return he(t)&&t.__isLong__===!0},e.fromValue=function(t,r){return typeof t=="number"?e.fromNumber(t,r):typeof t=="string"?e.fromString(t,r):e.fromBits(t.low,t.high,typeof r=="boolean"?r:t.unsigned)},e.prototype.add=function(t){e.isLong(t)||(t=e.fromValue(t));var r=this.high>>>16,n=this.high&65535,a=this.low>>>16,f=this.low&65535,s=t.high>>>16,p=t.high&65535,h=t.low>>>16,w=t.low&65535,g=0,u=0,_=0,T=0;return T+=f+w,_+=T>>>16,T&=65535,_+=a+h,u+=_>>>16,_&=65535,u+=n+p,g+=u>>>16,u&=65535,g+=r+s,g&=65535,e.fromBits(_<<16|T,g<<16|u,this.unsigned)},e.prototype.and=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low&t.low,this.high&t.high,this.unsigned)},e.prototype.compare=function(t){if(e.isLong(t)||(t=e.fromValue(t)),this.eq(t))return 0;var r=this.isNegative(),n=t.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},e.prototype.comp=function(t){return this.compare(t)},e.prototype.divide=function(t){if(e.isLong(t)||(t=e.fromValue(t)),t.isZero())throw Error("division by zero");if(nt){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var r=(this.unsigned?nt.div_u:nt.div_s)(this.low,this.high,t.low,t.high);return e.fromBits(r,nt.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?e.UZERO:e.ZERO;var n,a,f;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return e.UZERO;if(t.gt(this.shru(1)))return e.UONE;f=e.UZERO}else{if(this.eq(e.MIN_VALUE)){if(t.eq(e.ONE)||t.eq(e.NEG_ONE))return e.MIN_VALUE;if(t.eq(e.MIN_VALUE))return e.ONE;var s=this.shr(1);return n=s.div(t).shl(1),n.eq(e.ZERO)?t.isNegative()?e.ONE:e.NEG_ONE:(a=this.sub(t.mul(n)),f=n.add(a.div(t)),f)}else if(t.eq(e.MIN_VALUE))return this.unsigned?e.UZERO:e.ZERO;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();f=e.ZERO}for(a=this;a.gte(t);){n=Math.max(1,Math.floor(a.toNumber()/t.toNumber()));for(var p=Math.ceil(Math.log(n)/Math.LN2),h=p<=48?1:Math.pow(2,p-48),w=e.fromNumber(n),g=w.mul(t);g.isNegative()||g.gt(a);)n-=h,w=e.fromNumber(n,this.unsigned),g=w.mul(t);w.isZero()&&(w=e.ONE),f=f.add(w),a=a.sub(g)}return f},e.prototype.div=function(t){return this.divide(t)},e.prototype.equals=function(t){return e.isLong(t)||(t=e.fromValue(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low},e.prototype.eq=function(t){return this.equals(t)},e.prototype.getHighBits=function(){return this.high},e.prototype.getHighBitsUnsigned=function(){return this.high>>>0},e.prototype.getLowBits=function(){return this.low},e.prototype.getLowBitsUnsigned=function(){return this.low>>>0},e.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(e.MIN_VALUE)?64:this.neg().getNumBitsAbs();var t=this.high!==0?this.high:this.low,r;for(r=31;r>0&&!(t&1<<r);r--);return this.high!==0?r+33:r+1},e.prototype.greaterThan=function(t){return this.comp(t)>0},e.prototype.gt=function(t){return this.greaterThan(t)},e.prototype.greaterThanOrEqual=function(t){return this.comp(t)>=0},e.prototype.gte=function(t){return this.greaterThanOrEqual(t)},e.prototype.ge=function(t){return this.greaterThanOrEqual(t)},e.prototype.isEven=function(){return(this.low&1)===0},e.prototype.isNegative=function(){return!this.unsigned&&this.high<0},e.prototype.isOdd=function(){return(this.low&1)===1},e.prototype.isPositive=function(){return this.unsigned||this.high>=0},e.prototype.isZero=function(){return this.high===0&&this.low===0},e.prototype.lessThan=function(t){return this.comp(t)<0},e.prototype.lt=function(t){return this.lessThan(t)},e.prototype.lessThanOrEqual=function(t){return this.comp(t)<=0},e.prototype.lte=function(t){return this.lessThanOrEqual(t)},e.prototype.modulo=function(t){if(e.isLong(t)||(t=e.fromValue(t)),nt){var r=(this.unsigned?nt.rem_u:nt.rem_s)(this.low,this.high,t.low,t.high);return e.fromBits(r,nt.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))},e.prototype.mod=function(t){return this.modulo(t)},e.prototype.rem=function(t){return this.modulo(t)},e.prototype.multiply=function(t){if(this.isZero())return e.ZERO;if(e.isLong(t)||(t=e.fromValue(t)),nt){var r=nt.mul(this.low,this.high,t.low,t.high);return e.fromBits(r,nt.get_high(),this.unsigned)}if(t.isZero())return e.ZERO;if(this.eq(e.MIN_VALUE))return t.isOdd()?e.MIN_VALUE:e.ZERO;if(t.eq(e.MIN_VALUE))return this.isOdd()?e.MIN_VALUE:e.ZERO;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(e.TWO_PWR_24)&&t.lt(e.TWO_PWR_24))return e.fromNumber(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,f=this.low>>>16,s=this.low&65535,p=t.high>>>16,h=t.high&65535,w=t.low>>>16,g=t.low&65535,u=0,_=0,T=0,S=0;return S+=s*g,T+=S>>>16,S&=65535,T+=f*g,_+=T>>>16,T&=65535,T+=s*w,_+=T>>>16,T&=65535,_+=a*g,u+=_>>>16,_&=65535,_+=f*w,u+=_>>>16,_&=65535,_+=s*h,u+=_>>>16,_&=65535,u+=n*g+a*w+f*h+s*p,u&=65535,e.fromBits(T<<16|S,u<<16|_,this.unsigned)},e.prototype.mul=function(t){return this.multiply(t)},e.prototype.negate=function(){return!this.unsigned&&this.eq(e.MIN_VALUE)?e.MIN_VALUE:this.not().add(e.ONE)},e.prototype.neg=function(){return this.negate()},e.prototype.not=function(){return e.fromBits(~this.low,~this.high,this.unsigned)},e.prototype.notEquals=function(t){return!this.equals(t)},e.prototype.neq=function(t){return this.notEquals(t)},e.prototype.ne=function(t){return this.notEquals(t)},e.prototype.or=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low|t.low,this.high|t.high,this.unsigned)},e.prototype.shiftLeft=function(t){return e.isLong(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?e.fromBits(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):e.fromBits(0,this.low<<t-32,this.unsigned)},e.prototype.shl=function(t){return this.shiftLeft(t)},e.prototype.shiftRight=function(t){return e.isLong(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?e.fromBits(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):e.fromBits(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},e.prototype.shr=function(t){return this.shiftRight(t)},e.prototype.shiftRightUnsigned=function(t){if(e.isLong(t)&&(t=t.toInt()),t&=63,t===0)return this;var r=this.high;if(t<32){var n=this.low;return e.fromBits(n>>>t|r<<32-t,r>>>t,this.unsigned)}else return t===32?e.fromBits(r,0,this.unsigned):e.fromBits(r>>>t-32,0,this.unsigned)},e.prototype.shr_u=function(t){return this.shiftRightUnsigned(t)},e.prototype.shru=function(t){return this.shiftRightUnsigned(t)},e.prototype.subtract=function(t){return e.isLong(t)||(t=e.fromValue(t)),this.add(t.neg())},e.prototype.sub=function(t){return this.subtract(t)},e.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},e.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*Pt+(this.low>>>0):this.high*Pt+(this.low>>>0)},e.prototype.toBigInt=function(){return BigInt(this.toString())},e.prototype.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},e.prototype.toBytesLE=function(){var t=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]},e.prototype.toBytesBE=function(){var t=this.high,r=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,r>>>24,r>>>16&255,r>>>8&255,r&255]},e.prototype.toSigned=function(){return this.unsigned?e.fromBits(this.low,this.high,!1):this},e.prototype.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(e.MIN_VALUE)){var r=e.fromNumber(t),n=this.div(r),a=n.mul(r).sub(this);return n.toString(t)+a.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var f=e.fromNumber(Math.pow(t,6),this.unsigned),s=this,p="";;){var h=s.div(f),w=s.sub(h.mul(f)).toInt()>>>0,g=w.toString(t);if(s=h,s.isZero())return g+p;for(;g.length<6;)g="0"+g;p=""+g+p}},e.prototype.toUnsigned=function(){return this.unsigned?this:e.fromBits(this.low,this.high,!0)},e.prototype.xor=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low^t.low,this.high^t.high,this.unsigned)},e.prototype.eqz=function(){return this.isZero()},e.prototype.le=function(t){return this.lessThanOrEqual(t)},e.prototype.toExtendedJSON=function(t){return t&&t.relaxed?this.toNumber():{$numberLong:this.toString()}},e.fromExtendedJSON=function(t,r){var n=e.fromString(t.$numberLong);return r&&r.relaxed?n.toNumber():n},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new Long("'.concat(this.toString(),'"').concat(this.unsigned?", true":"",")")},e.TWO_PWR_24=e.fromInt(Ci),e.MAX_UNSIGNED_VALUE=e.fromBits(-1,-1,!0),e.ZERO=e.fromInt(0),e.UZERO=e.fromInt(0,!0),e.ONE=e.fromInt(1),e.UONE=e.fromInt(1,!0),e.NEG_ONE=e.fromInt(-1),e.MAX_VALUE=e.fromBits(-1,2147483647,!1),e.MIN_VALUE=e.fromBits(0,-2147483648,!1),e}();Object.defineProperty(v.prototype,"__isLong__",{value:!0});Object.defineProperty(v.prototype,"_bsontype",{value:"Long"});var ki=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,Wi=/^(\+|-)?(Infinity|inf)$/i,Ji=/^(\+|-)?NaN$/i,Kt=6111,ke=-6176,Vr=6176,Vi=34,We=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),Hr=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),Yr=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),Hi=/^([-+])?(\d+)?$/,Yi=31,zr=16383,zi=30,Gi=31;function Gr(e){return!isNaN(parseInt(e,10))}function Xi(e){var t=v.fromNumber(1e9),r=v.fromNumber(0);if(!e.parts[0]&&!e.parts[1]&&!e.parts[2]&&!e.parts[3])return{quotient:e,rem:r};for(var n=0;n<=3;n++)r=r.shiftLeft(32),r=r.add(new v(e.parts[n],0)),e.parts[n]=r.div(t).low,r=r.modulo(t);return{quotient:e,rem:r}}function Zi(e,t){if(!e&&!t)return{high:v.fromNumber(0),low:v.fromNumber(0)};var r=e.shiftRightUnsigned(32),n=new v(e.getLowBits(),0),a=t.shiftRightUnsigned(32),f=new v(t.getLowBits(),0),s=r.multiply(a),p=r.multiply(f),h=n.multiply(a),w=n.multiply(f);return s=s.add(p.shiftRightUnsigned(32)),p=new v(p.getLowBits(),0).add(h).add(w.shiftRightUnsigned(32)),s=s.add(p.shiftRightUnsigned(32)),w=p.shiftLeft(32).add(new v(w.getLowBits(),0)),{high:s,low:w}}function qi(e,t){var r=e.high>>>0,n=t.high>>>0;if(r<n)return!0;if(r===n){var a=e.low>>>0,f=t.low>>>0;if(a<f)return!0}return!1}function jt(e,t){throw new F('"'.concat(e,'" is not a valid Decimal128 string - ').concat(t))}var Vt=function(){function e(t){if(!(this instanceof e))return new e(t);if(typeof t=="string")this.bytes=e.fromString(t).bytes;else if(Bt(t)){if(t.byteLength!==16)throw new F("Decimal128 must take a Buffer of 16 bytes");this.bytes=t}else throw new F("Decimal128 must take a Buffer or string")}return e.fromString=function(t){var r=!1,n=!1,a=!1,f=0,s=0,p=0,h=0,w=0,g=[0],u=0,_=0,T=0,S=0,O=0,j=0,$=new v(0,0),P=new v(0,0),Y=0,N=0;if(t.length>=7e3)throw new F(""+t+" not a valid Decimal128 string");var Q=t.match(ki),tt=t.match(Wi),W=t.match(Ji);if(!Q&&!tt&&!W||t.length===0)throw new F(""+t+" not a valid Decimal128 string");if(Q){var Xt=Q[2],St=Q[4],Nt=Q[5],Ot=Q[6];St&&Ot===void 0&&jt(t,"missing exponent power"),St&&Xt===void 0&&jt(t,"missing exponent base"),St===void 0&&(Nt||Ot)&&jt(t,"missing e before exponent")}if((t[N]==="+"||t[N]==="-")&&(r=t[N++]==="-"),!Gr(t[N])&&t[N]!=="."){if(t[N]==="i"||t[N]==="I")return new e(E.from(r?Hr:Yr));if(t[N]==="N")return new e(E.from(We))}for(;Gr(t[N])||t[N]===".";){if(t[N]==="."){n&&jt(t,"contains multiple periods"),n=!0,N=N+1;continue}u<34&&(t[N]!=="0"||a)&&(a||(w=s),a=!0,g[_++]=parseInt(t[N],10),u=u+1),a&&(p=p+1),n&&(h=h+1),s=s+1,N=N+1}if(n&&!s)throw new F(""+t+" not a valid Decimal128 string");if(t[N]==="e"||t[N]==="E"){var L=t.substr(++N).match(Hi);if(!L||!L[2])return new e(E.from(We));O=parseInt(L[0],10),N=N+L[0].length}if(t[N])return new e(E.from(We));if(T=0,!u)T=0,S=0,g[0]=0,p=1,u=1,f=0;else if(S=u-1,f=p,f!==1)for(;g[w+f-1]===0;)f=f-1;for(O<=h&&h-O>16384?O=ke:O=O-h;O>Kt;){if(S=S+1,S-T>Vi){var A=g.join("");if(A.match(/^0+$/)){O=Kt;break}jt(t,"overflow")}O=O-1}for(;O<ke||u<p;){if(S===0&&f<u){O=ke,f=0;break}if(u<p?p=p-1:S=S-1,O<Kt)O=O+1;else{var A=g.join("");if(A.match(/^0+$/)){O=Kt;break}jt(t,"overflow")}}if(S-T+1<f){var z=s;n&&(w=w+1,z=z+1),r&&(w=w+1,z=z+1);var rt=parseInt(t[w+S+1],10),x=0;if(rt>=5&&(x=1,rt===5)){for(x=g[S]%2===1?1:0,j=w+S+2;j<z;j++)if(parseInt(t[j],10)){x=1;break}}if(x){for(var b=S;b>=0;b--)if(++g[b]>9&&(g[b]=0,b===0))if(O<Kt)O=O+1,g[b]=1;else return new e(E.from(r?Hr:Yr))}}if($=v.fromNumber(0),P=v.fromNumber(0),f===0)$=v.fromNumber(0),P=v.fromNumber(0);else if(S-T<17){var b=T;for(P=v.fromNumber(g[b++]),$=new v(0,0);b<=S;b++)P=P.multiply(v.fromNumber(10)),P=P.add(v.fromNumber(g[b]))}else{var b=T;for($=v.fromNumber(g[b++]);b<=S-17;b++)$=$.multiply(v.fromNumber(10)),$=$.add(v.fromNumber(g[b]));for(P=v.fromNumber(g[b++]);b<=S;b++)P=P.multiply(v.fromNumber(10)),P=P.add(v.fromNumber(g[b]))}var Z=Zi($,v.fromString("100000000000000000"));Z.low=Z.low.add(P),qi(Z.low,P)&&(Z.high=Z.high.add(v.fromNumber(1))),Y=O+Vr;var R={low:v.fromNumber(0),high:v.fromNumber(0)};Z.high.shiftRightUnsigned(49).and(v.fromNumber(1)).equals(v.fromNumber(1))?(R.high=R.high.or(v.fromNumber(3).shiftLeft(61)),R.high=R.high.or(v.fromNumber(Y).and(v.fromNumber(16383).shiftLeft(47))),R.high=R.high.or(Z.high.and(v.fromNumber(0x7fffffffffff)))):(R.high=R.high.or(v.fromNumber(Y&16383).shiftLeft(49)),R.high=R.high.or(Z.high.and(v.fromNumber(562949953421311)))),R.low=Z.low,r&&(R.high=R.high.or(v.fromString("9223372036854775808")));var I=E.alloc(16);return N=0,I[N++]=R.low.low&255,I[N++]=R.low.low>>8&255,I[N++]=R.low.low>>16&255,I[N++]=R.low.low>>24&255,I[N++]=R.low.high&255,I[N++]=R.low.high>>8&255,I[N++]=R.low.high>>16&255,I[N++]=R.low.high>>24&255,I[N++]=R.high.low&255,I[N++]=R.high.low>>8&255,I[N++]=R.high.low>>16&255,I[N++]=R.high.low>>24&255,I[N++]=R.high.high&255,I[N++]=R.high.high>>8&255,I[N++]=R.high.high>>16&255,I[N++]=R.high.high>>24&255,new e(I)},e.prototype.toString=function(){for(var t,r=0,n=new Array(36),a=0;a<n.length;a++)n[a]=0;var f=0,s=!1,p,h={parts:[0,0,0,0]},w,g,u=[];f=0;var _=this.bytes,T=_[f++]|_[f++]<<8|_[f++]<<16|_[f++]<<24,S=_[f++]|_[f++]<<8|_[f++]<<16|_[f++]<<24,O=_[f++]|_[f++]<<8|_[f++]<<16|_[f++]<<24,j=_[f++]|_[f++]<<8|_[f++]<<16|_[f++]<<24;f=0;var $={low:new v(T,S),high:new v(O,j)};$.high.lessThan(v.ZERO)&&u.push("-");var P=j>>26&Yi;if(P>>3===3){if(P===zi)return u.join("")+"Infinity";if(P===Gi)return"NaN";t=j>>15&zr,p=8+(j>>14&1)}else p=j>>14&7,t=j>>17&zr;var Y=t-Vr;if(h.parts[0]=(j&16383)+((p&15)<<14),h.parts[1]=O,h.parts[2]=S,h.parts[3]=T,h.parts[0]===0&&h.parts[1]===0&&h.parts[2]===0&&h.parts[3]===0)s=!0;else for(g=3;g>=0;g--){var N=0,Q=Xi(h);if(h=Q.quotient,N=Q.rem.low,!!N)for(w=8;w>=0;w--)n[g*9+w]=N%10,N=Math.floor(N/10)}if(s)r=1,n[f]=0;else for(r=36;!n[f];)r=r-1,f=f+1;var tt=r-1+Y;if(tt>=34||tt<=-7||Y>0){if(r>34)return u.push("".concat(0)),Y>0?u.push("E+".concat(Y)):Y<0&&u.push("E".concat(Y)),u.join("");u.push("".concat(n[f++])),r=r-1,r&&u.push(".");for(var a=0;a<r;a++)u.push("".concat(n[f++]));u.push("E"),tt>0?u.push("+".concat(tt)):u.push("".concat(tt))}else if(Y>=0)for(var a=0;a<r;a++)u.push("".concat(n[f++]));else{var W=r+Y;if(W>0)for(var a=0;a<W;a++)u.push("".concat(n[f++]));else u.push("0");for(u.push(".");W++<0;)u.push("0");for(var a=0;a<r-Math.max(W-1,0);a++)u.push("".concat(n[f++]))}return u.join("")},e.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},e.prototype.toExtendedJSON=function(){return{$numberDecimal:this.toString()}},e.fromExtendedJSON=function(t){return e.fromString(t.$numberDecimal)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new Decimal128("'.concat(this.toString(),'")')},e}();Object.defineProperty(Vt.prototype,"_bsontype",{value:"Decimal128"});var It=function(){function e(t){if(!(this instanceof e))return new e(t);t instanceof Number&&(t=t.valueOf()),this.value=+t}return e.prototype.valueOf=function(){return this.value},e.prototype.toJSON=function(){return this.value},e.prototype.toString=function(t){return this.value.toString(t)},e.prototype.toExtendedJSON=function(t){return t&&(t.legacy||t.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-".concat(this.value.toFixed(1))}:{$numberDouble:Number.isInteger(this.value)?this.value.toFixed(1):this.value.toString()}},e.fromExtendedJSON=function(t,r){var n=parseFloat(t.$numberDouble);return r&&r.relaxed?n:new e(n)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var t=this.toExtendedJSON();return"new Double(".concat(t.$numberDouble,")")},e}();Object.defineProperty(It.prototype,"_bsontype",{value:"Double"});var Rt=function(){function e(t){if(!(this instanceof e))return new e(t);t instanceof Number&&(t=t.valueOf()),this.value=+t|0}return e.prototype.valueOf=function(){return this.value},e.prototype.toString=function(t){return this.value.toString(t)},e.prototype.toJSON=function(){return this.value},e.prototype.toExtendedJSON=function(t){return t&&(t.relaxed||t.legacy)?this.value:{$numberInt:this.value.toString()}},e.fromExtendedJSON=function(t,r){return r&&r.relaxed?parseInt(t.$numberInt,10):new e(t.$numberInt)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new Int32(".concat(this.valueOf(),")")},e}();Object.defineProperty(Rt.prototype,"_bsontype",{value:"Int32"});var Ht=function(){function e(){if(!(this instanceof e))return new e}return e.prototype.toExtendedJSON=function(){return{$maxKey:1}},e.fromExtendedJSON=function(){return new e},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new MaxKey()"},e}();Object.defineProperty(Ht.prototype,"_bsontype",{value:"MaxKey"});var Yt=function(){function e(){if(!(this instanceof e))return new e}return e.prototype.toExtendedJSON=function(){return{$minKey:1}},e.fromExtendedJSON=function(){return new e},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new MinKey()"},e}();Object.defineProperty(Yt.prototype,"_bsontype",{value:"MinKey"});var Ki=new RegExp("^[0-9a-fA-F]{24}$"),bt=null,ct=Symbol("id"),V=function(){function e(t){if(!(this instanceof e))return new e(t);var r;if(typeof t=="object"&&t&&"id"in t){if(typeof t.id!="string"&&!ArrayBuffer.isView(t.id))throw new F("Argument passed in must have an id that is of type string or Buffer");"toHexString"in t&&typeof t.toHexString=="function"?r=E.from(t.toHexString(),"hex"):r=t.id}else r=t;if(r==null||typeof r=="number")this[ct]=e.generate(typeof r=="number"?r:void 0);else if(ArrayBuffer.isView(r)&&r.byteLength===12)this[ct]=r instanceof E?r:xt(r);else if(typeof r=="string")if(r.length===12){var n=E.from(r);if(n.byteLength===12)this[ct]=n;else throw new F("Argument passed in must be a string of 12 bytes")}else if(r.length===24&&Ki.test(r))this[ct]=E.from(r,"hex");else throw new F("Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer");else throw new F("Argument passed in does not match the accepted types");e.cacheHexString&&(this.__id=this.id.toString("hex"))}return Object.defineProperty(e.prototype,"id",{get:function(){return this[ct]},set:function(t){this[ct]=t,e.cacheHexString&&(this.__id=t.toString("hex"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"generationTime",{get:function(){return this.id.readInt32BE(0)},set:function(t){this.id.writeUInt32BE(t,0)},enumerable:!1,configurable:!0}),e.prototype.toHexString=function(){if(e.cacheHexString&&this.__id)return this.__id;var t=this.id.toString("hex");return e.cacheHexString&&!this.__id&&(this.__id=t),t},e.getInc=function(){return e.index=(e.index+1)%16777215},e.generate=function(t){typeof t!="number"&&(t=Math.floor(Date.now()/1e3));var r=e.getInc(),n=E.alloc(12);return n.writeUInt32BE(t,0),bt===null&&(bt=En(5)),n[4]=bt[0],n[5]=bt[1],n[6]=bt[2],n[7]=bt[3],n[8]=bt[4],n[11]=r&255,n[10]=r>>8&255,n[9]=r>>16&255,n},e.prototype.toString=function(t){return t?this.id.toString(t):this.toHexString()},e.prototype.toJSON=function(){return this.toHexString()},e.prototype.equals=function(t){if(t==null)return!1;if(t instanceof e)return this[ct][11]===t[ct][11]&&this[ct].equals(t[ct]);if(typeof t=="string"&&e.isValid(t)&&t.length===12&&Bt(this.id))return t===E.prototype.toString.call(this.id,"latin1");if(typeof t=="string"&&e.isValid(t)&&t.length===24)return t.toLowerCase()===this.toHexString();if(typeof t=="string"&&e.isValid(t)&&t.length===12)return E.from(t).equals(this.id);if(typeof t=="object"&&"toHexString"in t&&typeof t.toHexString=="function"){var r=t.toHexString(),n=this.toHexString().toLowerCase();return typeof r=="string"&&r.toLowerCase()===n}return!1},e.prototype.getTimestamp=function(){var t=new Date,r=this.id.readUInt32BE(0);return t.setTime(Math.floor(r)*1e3),t},e.createPk=function(){return new e},e.createFromTime=function(t){var r=E.from([0,0,0,0,0,0,0,0,0,0,0,0]);return r.writeUInt32BE(t,0),new e(r)},e.createFromHexString=function(t){if(typeof t>"u"||t!=null&&t.length!==24)throw new F("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");return new e(E.from(t,"hex"))},e.isValid=function(t){if(t==null)return!1;try{return new e(t),!0}catch{return!1}},e.prototype.toExtendedJSON=function(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}},e.fromExtendedJSON=function(t){return new e(t.$oid)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new ObjectId("'.concat(this.toHexString(),'")')},e.index=Math.floor(Math.random()*16777215),e}();Object.defineProperty(V.prototype,"generate",{value:Re(function(e){return V.generate(e)},"Please use the static `ObjectId.generate(time)` instead")});Object.defineProperty(V.prototype,"getInc",{value:Re(function(){return V.getInc()},"Please use the static `ObjectId.getInc()` instead")});Object.defineProperty(V.prototype,"get_inc",{value:Re(function(){return V.getInc()},"Please use the static `ObjectId.getInc()` instead")});Object.defineProperty(V,"get_inc",{value:Re(function(){return V.getInc()},"Please use the static `ObjectId.getInc()` instead")});Object.defineProperty(V.prototype,"_bsontype",{value:"ObjectID"});function Qi(e){return e.split("").sort().join("")}var vt=function(){function e(t,r){if(!(this instanceof e))return new e(t,r);if(this.pattern=t,this.options=Qi(r??""),this.pattern.indexOf("\0")!==-1)throw new B("BSON Regex patterns cannot contain null bytes, found: ".concat(JSON.stringify(this.pattern)));if(this.options.indexOf("\0")!==-1)throw new B("BSON Regex options cannot contain null bytes, found: ".concat(JSON.stringify(this.options)));for(var n=0;n<this.options.length;n++)if(!(this.options[n]==="i"||this.options[n]==="m"||this.options[n]==="x"||this.options[n]==="l"||this.options[n]==="s"||this.options[n]==="u"))throw new B("The regular expression option [".concat(this.options[n],"] is not supported"))}return e.parseOptions=function(t){return t?t.split("").sort().join(""):""},e.prototype.toExtendedJSON=function(t){return t=t||{},t.legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}},e.fromExtendedJSON=function(t){if("$regex"in t)if(typeof t.$regex!="string"){if(t.$regex._bsontype==="BSONRegExp")return t}else return new e(t.$regex,e.parseOptions(t.$options));if("$regularExpression"in t)return new e(t.$regularExpression.pattern,e.parseOptions(t.$regularExpression.options));throw new F("Unexpected BSONRegExp EJSON object form: ".concat(JSON.stringify(t)))},e}();Object.defineProperty(vt.prototype,"_bsontype",{value:"BSONRegExp"});var zt=function(){function e(t){if(!(this instanceof e))return new e(t);this.value=t}return e.prototype.valueOf=function(){return this.value},e.prototype.toString=function(){return this.value},e.prototype.inspect=function(){return'new BSONSymbol("'.concat(this.value,'")')},e.prototype.toJSON=function(){return this.value},e.prototype.toExtendedJSON=function(){return{$symbol:this.value}},e.fromExtendedJSON=function(t){return new e(t.$symbol)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e}();Object.defineProperty(zt.prototype,"_bsontype",{value:"Symbol"});var xn=v,ue=function(e){Ie(t,e);function t(r,n){var a=this;return a instanceof t?(v.isLong(r)?a=e.call(this,r.low,r.high,!0)||this:he(r)&&typeof r.t<"u"&&typeof r.i<"u"?a=e.call(this,r.i,r.t,!0)||this:a=e.call(this,r,n,!0)||this,Object.defineProperty(a,"_bsontype",{value:"Timestamp",writable:!1,configurable:!1,enumerable:!1}),a):new t(r,n)}return t.prototype.toJSON=function(){return{$timestamp:this.toString()}},t.fromInt=function(r){return new t(v.fromInt(r,!0))},t.fromNumber=function(r){return new t(v.fromNumber(r,!0))},t.fromBits=function(r,n){return new t(r,n)},t.fromString=function(r,n){return new t(v.fromString(r,!0,n))},t.prototype.toExtendedJSON=function(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}},t.fromExtendedJSON=function(r){return new t(r.$timestamp)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new Timestamp({ t: ".concat(this.getHighBits(),", i: ").concat(this.getLowBits()," })")},t.MAX_VALUE=v.MAX_UNSIGNED_VALUE,t}(xn);function In(e){return he(e)&&Reflect.has(e,"_bsontype")&&typeof e._bsontype=="string"}var Rn=2147483647,Un=-2147483648,Ln=9223372036854776e3,Dn=-9223372036854776e3,to={$oid:V,$binary:X,$uuid:X,$symbol:zt,$numberInt:Rt,$numberDecimal:Vt,$numberDouble:It,$numberLong:v,$minKey:Yt,$maxKey:Ht,$regex:vt,$regularExpression:vt,$timestamp:ue};function Fn(e,t){if(t===void 0&&(t={}),typeof e=="number"){if(t.relaxed||t.legacy)return e;if(Math.floor(e)===e){if(e>=Un&&e<=Rn)return new Rt(e);if(e>=Dn&&e<=Ln)return v.fromNumber(e)}return new It(e)}if(e==null||typeof e!="object")return e;if(e.$undefined)return null;for(var r=Object.keys(e).filter(function(u){return u.startsWith("$")&&e[u]!=null}),n=0;n<r.length;n++){var a=to[r[n]];if(a)return a.fromExtendedJSON(e,t)}if(e.$date!=null){var f=e.$date,s=new Date;return t.legacy?typeof f=="number"?s.setTime(f):typeof f=="string"&&s.setTime(Date.parse(f)):typeof f=="string"?s.setTime(Date.parse(f)):v.isLong(f)?s.setTime(f.toNumber()):typeof f=="number"&&t.relaxed&&s.setTime(f),s}if(e.$code!=null){var p=Object.assign({},e);return e.$scope&&(p.$scope=Fn(e.$scope)),_t.fromExtendedJSON(e)}if(Bn(e)||e.$dbPointer){var h=e.$ref?e:e.$dbPointer;if(h instanceof yt)return h;var w=Object.keys(h).filter(function(u){return u.startsWith("$")}),g=!0;if(w.forEach(function(u){["$ref","$id","$db"].indexOf(u)===-1&&(g=!1)}),g)return yt.fromExtendedJSON(h)}return e}function eo(e,t){return e.map(function(r,n){t.seenObjects.push({propertyName:"index ".concat(n),obj:null});try{return dt(r,t)}finally{t.seenObjects.pop()}})}function Xr(e){var t=e.toISOString();return e.getUTCMilliseconds()!==0?t:t.slice(0,-5)+"Z"}function dt(e,t){if((typeof e=="object"||typeof e=="function")&&e!==null){var r=t.seenObjects.findIndex(function($){return $.obj===e});if(r!==-1){var n=t.seenObjects.map(function($){return $.propertyName}),a=n.slice(0,r).map(function($){return"".concat($," -> ")}).join(""),f=n[r],s=" -> "+n.slice(r+1,n.length-1).map(function($){return"".concat($," -> ")}).join(""),p=n[n.length-1],h=" ".repeat(a.length+f.length/2),w="-".repeat(s.length+(f.length+p.length)/2-1);throw new F(`Converting circular structure to EJSON:
`+"    ".concat(a).concat(f).concat(s).concat(p,`
`)+"    ".concat(h,"\\").concat(w,"/"))}t.seenObjects[t.seenObjects.length-1].obj=e}if(Array.isArray(e))return eo(e,t);if(e===void 0)return null;if(e instanceof Date||re(e)){var g=e.getTime(),u=g>-1&&g<2534023188e5;return t.legacy?t.relaxed&&u?{$date:e.getTime()}:{$date:Xr(e)}:t.relaxed&&u?{$date:Xr(e)}:{$date:{$numberLong:e.getTime().toString()}}}if(typeof e=="number"&&(!t.relaxed||!isFinite(e))){if(Math.floor(e)===e){var _=e>=Un&&e<=Rn,T=e>=Dn&&e<=Ln;if(_)return{$numberInt:e.toString()};if(T)return{$numberLong:e.toString()}}return{$numberDouble:e.toString()}}if(e instanceof RegExp||kt(e)){var S=e.flags;if(S===void 0){var O=e.toString().match(/[gimuy]*$/);O&&(S=O[0])}var j=new vt(e.source,S);return j.toExtendedJSON(t)}return e!=null&&typeof e=="object"?no(e,t):e}var ro={Binary:function(e){return new X(e.value(),e.sub_type)},Code:function(e){return new _t(e.code,e.scope)},DBRef:function(e){return new yt(e.collection||e.namespace,e.oid,e.db,e.fields)},Decimal128:function(e){return new Vt(e.bytes)},Double:function(e){return new It(e.value)},Int32:function(e){return new Rt(e.value)},Long:function(e){return v.fromBits(e.low!=null?e.low:e.low_,e.low!=null?e.high:e.high_,e.low!=null?e.unsigned:e.unsigned_)},MaxKey:function(){return new Ht},MinKey:function(){return new Yt},ObjectID:function(e){return new V(e)},ObjectId:function(e){return new V(e)},BSONRegExp:function(e){return new vt(e.pattern,e.options)},Symbol:function(e){return new zt(e.value)},Timestamp:function(e){return ue.fromBits(e.low,e.high)}};function no(e,t){if(e==null||typeof e!="object")throw new B("not an object instance");var r=e._bsontype;if(typeof r>"u"){var n={};for(var a in e){t.seenObjects.push({propertyName:a,obj:null});try{var f=dt(e[a],t);a==="__proto__"?Object.defineProperty(n,a,{value:f,writable:!0,enumerable:!0,configurable:!0}):n[a]=f}finally{t.seenObjects.pop()}}return n}else if(In(e)){var s=e;if(typeof s.toExtendedJSON!="function"){var p=ro[e._bsontype];if(!p)throw new F("Unrecognized or invalid _bsontype: "+e._bsontype);s=p(s)}return r==="Code"&&s.scope?s=new _t(s.code,dt(s.scope,t)):r==="DBRef"&&s.oid&&(s=new yt(dt(s.collection,t),dt(s.oid,t),dt(s.db,t),dt(s.fields,t))),s.toExtendedJSON(t)}else throw new B("_bsontype must be a string, but was: "+typeof r)}var wt;(function(e){function t(f,s){var p=Object.assign({},{relaxed:!0,legacy:!1},s);return typeof p.relaxed=="boolean"&&(p.strict=!p.relaxed),typeof p.strict=="boolean"&&(p.relaxed=!p.strict),JSON.parse(f,function(h,w){if(h.indexOf("\0")!==-1)throw new B("BSON Document field names cannot contain null bytes, found: ".concat(JSON.stringify(h)));return Fn(w,p)})}e.parse=t;function r(f,s,p,h){p!=null&&typeof p=="object"&&(h=p,p=0),s!=null&&typeof s=="object"&&!Array.isArray(s)&&(h=s,s=void 0,p=0);var w=Object.assign({relaxed:!0,legacy:!1},h,{seenObjects:[{propertyName:"(root)",obj:null}]}),g=dt(f,w);return JSON.stringify(g,s,p)}e.stringify=r;function n(f,s){return s=s||{},JSON.parse(r(f,s))}e.serialize=n;function a(f,s){return s=s||{},t(JSON.stringify(f),s)}e.deserialize=a})(wt||(wt={}));var fe,Zr=mn();Zr.Map?fe=Zr.Map:fe=function(){function e(t){t===void 0&&(t=[]),this._keys=[],this._values={};for(var r=0;r<t.length;r++)if(t[r]!=null){var n=t[r],a=n[0],f=n[1];this._keys.push(a),this._values[a]={v:f,i:this._keys.length-1}}}return e.prototype.clear=function(){this._keys=[],this._values={}},e.prototype.delete=function(t){var r=this._values[t];return r==null?!1:(delete this._values[t],this._keys.splice(r.i,1),!0)},e.prototype.entries=function(){var t=this,r=0;return{next:function(){var n=t._keys[r++];return{value:n!==void 0?[n,t._values[n].v]:void 0,done:n===void 0}}}},e.prototype.forEach=function(t,r){r=r||this;for(var n=0;n<this._keys.length;n++){var a=this._keys[n];t.call(r,this._values[a].v,a,r)}},e.prototype.get=function(t){return this._values[t]?this._values[t].v:void 0},e.prototype.has=function(t){return this._values[t]!=null},e.prototype.keys=function(){var t=this,r=0;return{next:function(){var n=t._keys[r++];return{value:n!==void 0?n:void 0,done:n===void 0}}}},e.prototype.set=function(t,r){return this._values[t]?(this._values[t].v=r,this):(this._keys.push(t),this._values[t]={v:r,i:this._keys.length-1},this)},e.prototype.values=function(){var t=this,r=0;return{next:function(){var n=t._keys[r++];return{value:n!==void 0?t._values[n].v:void 0,done:n===void 0}}}},Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!1,configurable:!0}),e}();function te(e,t,r){var n=5;if(Array.isArray(e))for(var a=0;a<e.length;a++)n+=qr(a.toString(),e[a],t,!0,r);else{typeof(e==null?void 0:e.toBSON)=="function"&&(e=e.toBSON());for(var f in e)n+=qr(f,e[f],t,!1,r)}return n}function qr(e,t,r,n,a){switch(r===void 0&&(r=!1),n===void 0&&(n=!1),a===void 0&&(a=!1),typeof(t==null?void 0:t.toBSON)=="function"&&(t=t.toBSON()),typeof t){case"string":return 1+E.byteLength(e,"utf8")+1+4+E.byteLength(t,"utf8")+1;case"number":return Math.floor(t)===t&&t>=Nn&&t<=Sn&&t>=Sr&&t<=vr?(e!=null?E.byteLength(e,"utf8")+1:0)+(4+1):(e!=null?E.byteLength(e,"utf8")+1:0)+(8+1);case"undefined":return n||!a?(e!=null?E.byteLength(e,"utf8")+1:0)+1:0;case"boolean":return(e!=null?E.byteLength(e,"utf8")+1:0)+(1+1);case"object":if(t==null||t._bsontype==="MinKey"||t._bsontype==="MaxKey")return(e!=null?E.byteLength(e,"utf8")+1:0)+1;if(t._bsontype==="ObjectId"||t._bsontype==="ObjectID")return(e!=null?E.byteLength(e,"utf8")+1:0)+(12+1);if(t instanceof Date||re(t))return(e!=null?E.byteLength(e,"utf8")+1:0)+(8+1);if(ArrayBuffer.isView(t)||t instanceof ArrayBuffer||_n(t))return(e!=null?E.byteLength(e,"utf8")+1:0)+(1+4+1)+t.byteLength;if(t._bsontype==="Long"||t._bsontype==="Double"||t._bsontype==="Timestamp")return(e!=null?E.byteLength(e,"utf8")+1:0)+(8+1);if(t._bsontype==="Decimal128")return(e!=null?E.byteLength(e,"utf8")+1:0)+(16+1);if(t._bsontype==="Code")return t.scope!=null&&Object.keys(t.scope).length>0?(e!=null?E.byteLength(e,"utf8")+1:0)+1+4+4+E.byteLength(t.code.toString(),"utf8")+1+te(t.scope,r,a):(e!=null?E.byteLength(e,"utf8")+1:0)+1+4+E.byteLength(t.code.toString(),"utf8")+1;if(t._bsontype==="Binary"){var f=t;return f.sub_type===X.SUBTYPE_BYTE_ARRAY?(e!=null?E.byteLength(e,"utf8")+1:0)+(f.position+1+4+1+4):(e!=null?E.byteLength(e,"utf8")+1:0)+(f.position+1+4+1)}else{if(t._bsontype==="Symbol")return(e!=null?E.byteLength(e,"utf8")+1:0)+E.byteLength(t.value,"utf8")+4+1+1;if(t._bsontype==="DBRef"){var s=Object.assign({$ref:t.collection,$id:t.oid},t.fields);return t.db!=null&&(s.$db=t.db),(e!=null?E.byteLength(e,"utf8")+1:0)+1+te(s,r,a)}else return t instanceof RegExp||kt(t)?(e!=null?E.byteLength(e,"utf8")+1:0)+1+E.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1:t._bsontype==="BSONRegExp"?(e!=null?E.byteLength(e,"utf8")+1:0)+1+E.byteLength(t.pattern,"utf8")+1+E.byteLength(t.options,"utf8")+1:(e!=null?E.byteLength(e,"utf8")+1:0)+te(t,r,a)+1}case"function":if(t instanceof RegExp||kt(t)||String.call(t)==="[object RegExp]")return(e!=null?E.byteLength(e,"utf8")+1:0)+1+E.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1;if(r&&t.scope!=null&&Object.keys(t.scope).length>0)return(e!=null?E.byteLength(e,"utf8")+1:0)+1+4+4+E.byteLength(gr(t),"utf8")+1+te(t.scope,r,a);if(r)return(e!=null?E.byteLength(e,"utf8")+1:0)+1+4+E.byteLength(gr(t),"utf8")+1}return 0}var io=128,oo=192,so=224,ao=240,fo=248,co=192,ho=224,uo=240,lo=128;function jn(e,t,r){for(var n=0,a=t;a<r;a+=1){var f=e[a];if(n){if((f&oo)!==lo)return!1;n-=1}else if(f&io)if((f&so)===co)n=1;else if((f&ao)===ho)n=2;else if((f&fo)===uo)n=3;else return!1}return!n}var po=v.fromNumber(Sn),go=v.fromNumber(Nn),Kr={};function Mn(e,t,r){t=t??{};var n=t&&t.index?t.index:0,a=e[n]|e[n+1]<<8|e[n+2]<<16|e[n+3]<<24;if(a<5)throw new B("bson size must be >= 5, is ".concat(a));if(t.allowObjectSmallerThanBufferSize&&e.length<a)throw new B("buffer length ".concat(e.length," must be >= bson size ").concat(a));if(!t.allowObjectSmallerThanBufferSize&&e.length!==a)throw new B("buffer length ".concat(e.length," must === bson size ").concat(a));if(a+n>e.byteLength)throw new B("(bson size ".concat(a," + options.index ").concat(n," must be <= buffer length ").concat(e.byteLength,")"));if(e[n+a-1]!==0)throw new B("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return Se(e,n,t,r)}var yo=/^\$ref$|^\$id$|^\$db$/;function Se(e,t,r,n){n===void 0&&(n=!1);var a=r.evalFunctions==null?!1:r.evalFunctions,f=r.cacheFunctions==null?!1:r.cacheFunctions,s=r.fieldsAsRaw==null?null:r.fieldsAsRaw,p=r.raw==null?!1:r.raw,h=typeof r.bsonRegExp=="boolean"?r.bsonRegExp:!1,w=r.promoteBuffers==null?!1:r.promoteBuffers,g=r.promoteLongs==null?!0:r.promoteLongs,u=r.promoteValues==null?!0:r.promoteValues,_=r.validation==null?{utf8:!0}:r.validation,T=!0,S,O=new Set,j=_.utf8;if(typeof j=="boolean")S=j;else{T=!1;var $=Object.keys(j).map(function(M){return j[M]});if($.length===0)throw new B("UTF-8 validation setting cannot be empty");if(typeof $[0]!="boolean")throw new B("Invalid UTF-8 validation option, must specify boolean values");if(S=$[0],!$.every(function(M){return M===S}))throw new B("Invalid UTF-8 validation option - keys must be all true or all false")}if(!T)for(var P=0,Y=Object.keys(j);P<Y.length;P++){var N=Y[P];O.add(N)}var Q=t;if(e.length<5)throw new B("corrupt bson message < 5 bytes long");var tt=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(tt<5||tt>e.length)throw new B("corrupt bson message");for(var W=n?[]:{},Xt=0,St=!1,Nt=n?!1:null,Ot=new DataView(e.buffer,e.byteOffset,e.byteLength);!St;){var L=e[t++];if(L===0)break;for(var A=t;e[A]!==0&&A<e.length;)A++;if(A>=e.byteLength)throw new B("Bad BSON Document: illegal CString");var z=n?Xt++:e.toString("utf8",t,A),rt=!0;T||O.has(z)?rt=S:rt=!S,Nt!==!1&&z[0]==="$"&&(Nt=yo.test(z));var x=void 0;if(t=A+1,L===Nr){var b=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(b<=0||b>e.length-t||e[t+b-1]!==0)throw new B("bad string length in bson");x=me(e,t,t+b-1,rt),t=t+b}else if(L===br){var Z=E.alloc(12);e.copy(Z,0,t,t+12),x=new V(Z),t=t+12}else if(L===se&&u===!1)x=new Rt(e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24);else if(L===se)x=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;else if(L===ie&&u===!1)x=new It(Ot.getFloat64(t,!0)),t=t+8;else if(L===ie)x=Ot.getFloat64(t,!0),t=t+8;else if(L===Br){var R=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,I=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;x=new Date(new v(R,I).toNumber())}else if(L===Ar){if(e[t]!==0&&e[t]!==1)throw new B("illegal boolean type value");x=e[t++]===1}else if(L===Ue){var J=t,et=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24;if(et<=0||et>e.length-t)throw new B("bad embedded document length in bson");if(p)x=e.slice(t,t+et);else{var Zt=r;T||(Zt=$t($t({},r),{validation:{utf8:rt}})),x=Se(e,J,Zt,!1)}t=t+et}else if(L===Or){var J=t,et=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,lt=r,Me=t+et;if(s&&s[z]){lt={};for(var pe in r)lt[pe]=r[pe];lt.raw=!0}if(T||(lt=$t($t({},lt),{validation:{utf8:rt}})),x=Se(e,J,lt,!0),t=t+et,e[t-1]!==0)throw new B("invalid array terminator byte");if(t!==Me)throw new B("corrupted array bson")}else if(L===On)x=void 0;else if(L===De)x=null;else if(L===Rr){var R=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,I=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,pt=new v(R,I);g&&u===!0?x=pt.lessThanOrEqual(po)&&pt.greaterThanOrEqual(go)?pt.toNumber():pt:x=pt}else if(L===Ur){var ge=E.alloc(16);e.copy(ge,0,t,t+16),t=t+16;var Ut=new Vt(ge);"toObject"in Ut&&typeof Ut.toObject=="function"?x=Ut.toObject():x=Ut}else if(L===Le){var k=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,gt=k,H=e[t++];if(k<0)throw new B("Negative binary type element size found");if(k>e.byteLength)throw new B("Binary type size larger than document size");if(e.slice!=null){if(H===X.SUBTYPE_BYTE_ARRAY){if(k=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,k<0)throw new B("Negative binary type element size found for subtype 0x02");if(k>gt-4)throw new B("Binary type with subtype 0x02 contains too long binary size");if(k<gt-4)throw new B("Binary type with subtype 0x02 contains too short binary size")}w&&u?x=e.slice(t,t+k):(x=new X(e.slice(t,t+k),H),H===ae&&(x=x.toUUID()))}else{var Lt=E.alloc(k);if(H===X.SUBTYPE_BYTE_ARRAY){if(k=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,k<0)throw new B("Negative binary type element size found for subtype 0x02");if(k>gt-4)throw new B("Binary type with subtype 0x02 contains too long binary size");if(k<gt-4)throw new B("Binary type with subtype 0x02 contains too short binary size")}for(A=0;A<k;A++)Lt[A]=e[t+A];w&&u?x=Lt:H===ae?x=new X(e.slice(t,t+k),H).toUUID():x=new X(e.slice(t,t+k),H)}t=t+k}else if(L===oe&&h===!1){for(A=t;e[A]!==0&&A<e.length;)A++;if(A>=e.length)throw new B("Bad BSON Document: illegal CString");var qt=e.toString("utf8",t,A);for(t=A+1,A=t;e[A]!==0&&A<e.length;)A++;if(A>=e.length)throw new B("Bad BSON Document: illegal CString");var c=e.toString("utf8",t,A);t=A+1;var i=new Array(c.length);for(A=0;A<c.length;A++)switch(c[A]){case"m":i[A]="m";break;case"s":i[A]="g";break;case"i":i[A]="i";break}x=new RegExp(qt,i.join(""))}else if(L===oe&&h===!0){for(A=t;e[A]!==0&&A<e.length;)A++;if(A>=e.length)throw new B("Bad BSON Document: illegal CString");var qt=e.toString("utf8",t,A);for(t=A+1,A=t;e[A]!==0&&A<e.length;)A++;if(A>=e.length)throw new B("Bad BSON Document: illegal CString");var c=e.toString("utf8",t,A);t=A+1,x=new vt(qt,c)}else if(L===Tr){var b=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(b<=0||b>e.length-t||e[t+b-1]!==0)throw new B("bad string length in bson");var o=me(e,t,t+b-1,rt);x=u?o:new zt(o),t=t+b}else if(L===Ir){var R=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,I=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;x=new ue(R,I)}else if(L===Lr)x=new Yt;else if(L===Dr)x=new Ht;else if(L===Fe){var b=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(b<=0||b>e.length-t||e[t+b-1]!==0)throw new B("bad string length in bson");var l=me(e,t,t+b-1,rt);a?f?x=de(l,Kr,W):x=de(l):x=new _t(l),t=t+b}else if(L===xr){var y=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(y<4+4+4+1)throw new B("code_w_scope total size shorter minimum expected length");var b=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(b<=0||b>e.length-t||e[t+b-1]!==0)throw new B("bad string length in bson");var l=me(e,t,t+b-1,rt);t=t+b;var J=t,et=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,d=Se(e,J,r,!1);if(t=t+et,y<4+4+et+b)throw new B("code_w_scope total size is too short, truncating scope");if(y>4+4+et+b)throw new B("code_w_scope total size is too long, clips outer document");a?(f?x=de(l,Kr,W):x=de(l),x.scope=d):x=new _t(l,d)}else if(L===bn){var b=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(b<=0||b>e.length-t||e[t+b-1]!==0)throw new B("bad string length in bson");if(_!=null&&_.utf8&&!jn(e,t,t+b-1))throw new B("Invalid UTF-8 string in BSON document");var m=e.toString("utf8",t,t+b-1);t=t+b;var U=E.alloc(12);e.copy(U,0,t,t+12);var Z=new V(U);t=t+12,x=new yt(m,Z)}else throw new B("Detected unknown BSON type ".concat(L.toString(16),' for fieldname "').concat(z,'"'));z==="__proto__"?Object.defineProperty(W,z,{value:x,writable:!0,enumerable:!0,configurable:!0}):W[z]=x}if(tt!==t-Q)throw n?new B("corrupt array bson"):new B("corrupt object bson");if(!Nt)return W;if(Bn(W)){var D=Object.assign({},W);return delete D.$ref,delete D.$id,delete D.$db,new yt(W.$ref,W.$id,W.$db,D)}return W}function de(e,t,r){return t?(t[e]==null&&(t[e]=new Function(e)),t[e].bind(r)):new Function(e)}function me(e,t,r,n){var a=e.toString("utf8",t,r);if(n){for(var f=0;f<a.length;f++)if(a.charCodeAt(f)===65533){if(!jn(e,t,r))throw new B("Invalid UTF-8 string in BSON document");break}}return a}var be=/\x00/,Qr=new Set(["$db","$ref","$id","$clusterTime"]);function Je(e,t,r,n,a){e[n++]=Nr;var f=a?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");n=n+f+1,e[n-1]=0;var s=e.write(r,n+4,void 0,"utf8");return e[n+3]=s+1>>24&255,e[n+2]=s+1>>16&255,e[n+1]=s+1>>8&255,e[n]=s+1&255,n=n+4+s,e[n++]=0,n}var ne=new Uint8Array(8),$n=new DataView(ne.buffer,ne.byteOffset,ne.byteLength);function Ve(e,t,r,n,a){if(Number.isInteger(r)&&r>=Sr&&r<=vr){e[n++]=se;var f=a?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");n=n+f,e[n++]=0,e[n++]=r&255,e[n++]=r>>8&255,e[n++]=r>>16&255,e[n++]=r>>24&255}else{e[n++]=ie;var f=a?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");n=n+f,e[n++]=0,$n.setFloat64(0,r,!0),e.set(ne,n),n=n+8}return n}function Qt(e,t,r,n,a){e[n++]=De;var f=a?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");return n=n+f,e[n++]=0,n}function He(e,t,r,n,a){e[n++]=Ar;var f=a?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");return n=n+f,e[n++]=0,e[n++]=r?1:0,n}function Ye(e,t,r,n,a){e[n++]=Br;var f=a?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");n=n+f,e[n++]=0;var s=v.fromNumber(r.getTime()),p=s.getLowBits(),h=s.getHighBits();return e[n++]=p&255,e[n++]=p>>8&255,e[n++]=p>>16&255,e[n++]=p>>24&255,e[n++]=h&255,e[n++]=h>>8&255,e[n++]=h>>16&255,e[n++]=h>>24&255,n}function ze(e,t,r,n,a){e[n++]=oe;var f=a?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");if(n=n+f,e[n++]=0,r.source&&r.source.match(be)!=null)throw Error("value "+r.source+" must not contain null bytes");return n=n+e.write(r.source,n,void 0,"utf8"),e[n++]=0,r.ignoreCase&&(e[n++]=105),r.global&&(e[n++]=115),r.multiline&&(e[n++]=109),e[n++]=0,n}function Ge(e,t,r,n,a){e[n++]=oe;var f=a?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");if(n=n+f,e[n++]=0,r.pattern.match(be)!=null)throw Error("pattern "+r.pattern+" must not contain null bytes");return n=n+e.write(r.pattern,n,void 0,"utf8"),e[n++]=0,n=n+e.write(r.options.split("").sort().join(""),n,void 0,"utf8"),e[n++]=0,n}function Xe(e,t,r,n,a){r===null?e[n++]=De:r._bsontype==="MinKey"?e[n++]=Lr:e[n++]=Dr;var f=a?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");return n=n+f,e[n++]=0,n}function Ze(e,t,r,n,a){e[n++]=br;var f=a?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");if(n=n+f,e[n++]=0,typeof r.id=="string")e.write(r.id,n,void 0,"binary");else if(Bt(r.id))e.set(r.id.subarray(0,12),n);else throw new F("object ["+JSON.stringify(r)+"] is not a valid ObjectId");return n+12}function qe(e,t,r,n,a){e[n++]=Le;var f=a?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");n=n+f,e[n++]=0;var s=r.length;return e[n++]=s&255,e[n++]=s>>8&255,e[n++]=s>>16&255,e[n++]=s>>24&255,e[n++]=An,e.set(xt(r),n),n=n+s,n}function Ke(e,t,r,n,a,f,s,p,h,w){a===void 0&&(a=!1),f===void 0&&(f=0),s===void 0&&(s=!1),p===void 0&&(p=!0),h===void 0&&(h=!1),w===void 0&&(w=[]);for(var g=0;g<w.length;g++)if(w[g]===r)throw new B("cyclic dependency detected");w.push(r),e[n++]=Array.isArray(r)?Or:Ue;var u=h?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");n=n+u,e[n++]=0;var _=le(e,r,a,n,f+1,s,p,w);return w.pop(),_}function Qe(e,t,r,n,a){e[n++]=Ur;var f=a?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");return n=n+f,e[n++]=0,e.set(r.bytes.subarray(0,16),n),n+16}function tr(e,t,r,n,a){e[n++]=r._bsontype==="Long"?Rr:Ir;var f=a?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");n=n+f,e[n++]=0;var s=r.getLowBits(),p=r.getHighBits();return e[n++]=s&255,e[n++]=s>>8&255,e[n++]=s>>16&255,e[n++]=s>>24&255,e[n++]=p&255,e[n++]=p>>8&255,e[n++]=p>>16&255,e[n++]=p>>24&255,n}function er(e,t,r,n,a){r=r.valueOf(),e[n++]=se;var f=a?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");return n=n+f,e[n++]=0,e[n++]=r&255,e[n++]=r>>8&255,e[n++]=r>>16&255,e[n++]=r>>24&255,n}function rr(e,t,r,n,a){e[n++]=ie;var f=a?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");return n=n+f,e[n++]=0,$n.setFloat64(0,r.value,!0),e.set(ne,n),n=n+8,n}function nr(e,t,r,n,a,f,s){e[n++]=Fe;var p=s?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");n=n+p,e[n++]=0;var h=gr(r),w=e.write(h,n+4,void 0,"utf8")+1;return e[n]=w&255,e[n+1]=w>>8&255,e[n+2]=w>>16&255,e[n+3]=w>>24&255,n=n+4+w-1,e[n++]=0,n}function ir(e,t,r,n,a,f,s,p,h){if(a===void 0&&(a=!1),f===void 0&&(f=0),s===void 0&&(s=!1),p===void 0&&(p=!0),h===void 0&&(h=!1),r.scope&&typeof r.scope=="object"){e[n++]=xr;var w=h?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");n=n+w,e[n++]=0;var g=n,u=typeof r.code=="string"?r.code:r.code.toString();n=n+4;var _=e.write(u,n+4,void 0,"utf8")+1;e[n]=_&255,e[n+1]=_>>8&255,e[n+2]=_>>16&255,e[n+3]=_>>24&255,e[n+4+_-1]=0,n=n+_+4;var T=le(e,r.scope,a,n,f+1,s,p);n=T-1;var S=T-g;e[g++]=S&255,e[g++]=S>>8&255,e[g++]=S>>16&255,e[g++]=S>>24&255,e[n++]=0}else{e[n++]=Fe;var w=h?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");n=n+w,e[n++]=0;var u=r.code.toString(),O=e.write(u,n+4,void 0,"utf8")+1;e[n]=O&255,e[n+1]=O>>8&255,e[n+2]=O>>16&255,e[n+3]=O>>24&255,n=n+4+O-1,e[n++]=0}return n}function or(e,t,r,n,a){e[n++]=Le;var f=a?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");n=n+f,e[n++]=0;var s=r.value(!0),p=r.position;return r.sub_type===X.SUBTYPE_BYTE_ARRAY&&(p=p+4),e[n++]=p&255,e[n++]=p>>8&255,e[n++]=p>>16&255,e[n++]=p>>24&255,e[n++]=r.sub_type,r.sub_type===X.SUBTYPE_BYTE_ARRAY&&(p=p-4,e[n++]=p&255,e[n++]=p>>8&255,e[n++]=p>>16&255,e[n++]=p>>24&255),e.set(s,n),n=n+r.position,n}function sr(e,t,r,n,a){e[n++]=Tr;var f=a?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");n=n+f,e[n++]=0;var s=e.write(r.value,n+4,void 0,"utf8")+1;return e[n]=s&255,e[n+1]=s>>8&255,e[n+2]=s>>16&255,e[n+3]=s>>24&255,n=n+4+s-1,e[n++]=0,n}function ar(e,t,r,n,a,f,s){e[n++]=Ue;var p=s?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");n=n+p,e[n++]=0;var h=n,w={$ref:r.collection||r.namespace,$id:r.oid};r.db!=null&&(w.$db=r.db),w=Object.assign(w,r.fields);var g=le(e,w,!1,n,a+1,f),u=g-h;return e[h++]=u&255,e[h++]=u>>8&255,e[h++]=u>>16&255,e[h++]=u>>24&255,g}function le(e,t,r,n,a,f,s,p){r===void 0&&(r=!1),n===void 0&&(n=0),a===void 0&&(a=0),f===void 0&&(f=!1),s===void 0&&(s=!0),p===void 0&&(p=[]),n=n||0,p=p||[],p.push(t);var h=n+4;if(Array.isArray(t))for(var w=0;w<t.length;w++){var g="".concat(w),u=t[w];if(typeof(u==null?void 0:u.toBSON)=="function"&&(u=u.toBSON()),typeof u=="string")h=Je(e,g,u,h,!0);else if(typeof u=="number")h=Ve(e,g,u,h,!0);else{if(typeof u=="bigint")throw new F("Unsupported type BigInt, please use Decimal128");if(typeof u=="boolean")h=He(e,g,u,h,!0);else if(u instanceof Date||re(u))h=Ye(e,g,u,h,!0);else if(u===void 0)h=Qt(e,g,u,h,!0);else if(u===null)h=Qt(e,g,u,h,!0);else if(u._bsontype==="ObjectId"||u._bsontype==="ObjectID")h=Ze(e,g,u,h,!0);else if(Bt(u))h=qe(e,g,u,h,!0);else if(u instanceof RegExp||kt(u))h=ze(e,g,u,h,!0);else if(typeof u=="object"&&u._bsontype==null)h=Ke(e,g,u,h,r,a,f,s,!0,p);else if(typeof u=="object"&&In(u)&&u._bsontype==="Decimal128")h=Qe(e,g,u,h,!0);else if(u._bsontype==="Long"||u._bsontype==="Timestamp")h=tr(e,g,u,h,!0);else if(u._bsontype==="Double")h=rr(e,g,u,h,!0);else if(typeof u=="function"&&f)h=nr(e,g,u,h,r,a,!0);else if(u._bsontype==="Code")h=ir(e,g,u,h,r,a,f,s,!0);else if(u._bsontype==="Binary")h=or(e,g,u,h,!0);else if(u._bsontype==="Symbol")h=sr(e,g,u,h,!0);else if(u._bsontype==="DBRef")h=ar(e,g,u,h,a,f,!0);else if(u._bsontype==="BSONRegExp")h=Ge(e,g,u,h,!0);else if(u._bsontype==="Int32")h=er(e,g,u,h,!0);else if(u._bsontype==="MinKey"||u._bsontype==="MaxKey")h=Xe(e,g,u,h,!0);else if(typeof u._bsontype<"u")throw new F("Unrecognized or invalid _bsontype: ".concat(String(u._bsontype)))}}else if(t instanceof fe||xi(t))for(var _=t.entries(),T=!1;!T;){var S=_.next();if(T=!!S.done,!T){var g=S.value[0],u=S.value[1],O=typeof u;if(typeof g=="string"&&!Qr.has(g)){if(g.match(be)!=null)throw Error("key "+g+" must not contain null bytes");if(r){if(g[0]==="$")throw Error("key "+g+" must not start with '$'");if(~g.indexOf("."))throw Error("key "+g+" must not contain '.'")}}if(O==="string")h=Je(e,g,u,h);else if(O==="number")h=Ve(e,g,u,h);else{if(O==="bigint"||Bi(u)||Ti(u))throw new F("Unsupported type BigInt, please use Decimal128");if(O==="boolean")h=He(e,g,u,h);else if(u instanceof Date||re(u))h=Ye(e,g,u,h);else if(u===null||u===void 0&&s===!1)h=Qt(e,g,u,h);else if(u._bsontype==="ObjectId"||u._bsontype==="ObjectID")h=Ze(e,g,u,h);else if(Bt(u))h=qe(e,g,u,h);else if(u instanceof RegExp||kt(u))h=ze(e,g,u,h);else if(O==="object"&&u._bsontype==null)h=Ke(e,g,u,h,r,a,f,s,!1,p);else if(O==="object"&&u._bsontype==="Decimal128")h=Qe(e,g,u,h);else if(u._bsontype==="Long"||u._bsontype==="Timestamp")h=tr(e,g,u,h);else if(u._bsontype==="Double")h=rr(e,g,u,h);else if(u._bsontype==="Code")h=ir(e,g,u,h,r,a,f,s);else if(typeof u=="function"&&f)h=nr(e,g,u,h,r,a,f);else if(u._bsontype==="Binary")h=or(e,g,u,h);else if(u._bsontype==="Symbol")h=sr(e,g,u,h);else if(u._bsontype==="DBRef")h=ar(e,g,u,h,a,f);else if(u._bsontype==="BSONRegExp")h=Ge(e,g,u,h);else if(u._bsontype==="Int32")h=er(e,g,u,h);else if(u._bsontype==="MinKey"||u._bsontype==="MaxKey")h=Xe(e,g,u,h);else if(typeof u._bsontype<"u")throw new F("Unrecognized or invalid _bsontype: ".concat(String(u._bsontype)))}}}else{if(typeof(t==null?void 0:t.toBSON)=="function"&&(t=t.toBSON(),t!=null&&typeof t!="object"))throw new F("toBSON function did not return an object");for(var g in t){var u=t[g];typeof(u==null?void 0:u.toBSON)=="function"&&(u=u.toBSON());var O=typeof u;if(typeof g=="string"&&!Qr.has(g)){if(g.match(be)!=null)throw Error("key "+g+" must not contain null bytes");if(r){if(g[0]==="$")throw Error("key "+g+" must not start with '$'");if(~g.indexOf("."))throw Error("key "+g+" must not contain '.'")}}if(O==="string")h=Je(e,g,u,h);else if(O==="number")h=Ve(e,g,u,h);else{if(O==="bigint")throw new F("Unsupported type BigInt, please use Decimal128");if(O==="boolean")h=He(e,g,u,h);else if(u instanceof Date||re(u))h=Ye(e,g,u,h);else if(u===void 0)s===!1&&(h=Qt(e,g,u,h));else if(u===null)h=Qt(e,g,u,h);else if(u._bsontype==="ObjectId"||u._bsontype==="ObjectID")h=Ze(e,g,u,h);else if(Bt(u))h=qe(e,g,u,h);else if(u instanceof RegExp||kt(u))h=ze(e,g,u,h);else if(O==="object"&&u._bsontype==null)h=Ke(e,g,u,h,r,a,f,s,!1,p);else if(O==="object"&&u._bsontype==="Decimal128")h=Qe(e,g,u,h);else if(u._bsontype==="Long"||u._bsontype==="Timestamp")h=tr(e,g,u,h);else if(u._bsontype==="Double")h=rr(e,g,u,h);else if(u._bsontype==="Code")h=ir(e,g,u,h,r,a,f,s);else if(typeof u=="function"&&f)h=nr(e,g,u,h,r,a,f);else if(u._bsontype==="Binary")h=or(e,g,u,h);else if(u._bsontype==="Symbol")h=sr(e,g,u,h);else if(u._bsontype==="DBRef")h=ar(e,g,u,h,a,f);else if(u._bsontype==="BSONRegExp")h=Ge(e,g,u,h);else if(u._bsontype==="Int32")h=er(e,g,u,h);else if(u._bsontype==="MinKey"||u._bsontype==="MaxKey")h=Xe(e,g,u,h);else if(typeof u._bsontype<"u")throw new F("Unrecognized or invalid _bsontype: ".concat(String(u._bsontype)))}}}p.pop(),e[h++]=0;var j=h-n;return e[n++]=j&255,e[n++]=j>>8&255,e[n++]=j>>16&255,e[n++]=j>>24&255,h}var Pn=1024*1024*17,mt=E.alloc(Pn);function Cn(e){mt.length<e&&(mt=E.alloc(e))}function kn(e,t){t===void 0&&(t={});var r=typeof t.checkKeys=="boolean"?t.checkKeys:!1,n=typeof t.serializeFunctions=="boolean"?t.serializeFunctions:!1,a=typeof t.ignoreUndefined=="boolean"?t.ignoreUndefined:!0,f=typeof t.minInternalBufferSize=="number"?t.minInternalBufferSize:Pn;mt.length<f&&(mt=E.alloc(f));var s=le(mt,e,r,0,0,n,a,[]),p=E.alloc(s);return mt.copy(p,0,0,p.length),p}function Wn(e,t,r){r===void 0&&(r={});var n=typeof r.checkKeys=="boolean"?r.checkKeys:!1,a=typeof r.serializeFunctions=="boolean"?r.serializeFunctions:!1,f=typeof r.ignoreUndefined=="boolean"?r.ignoreUndefined:!0,s=typeof r.index=="number"?r.index:0,p=le(mt,e,n,0,0,a,f);return mt.copy(t,s,0,p),s+p-1}function Jn(e,t){return t===void 0&&(t={}),Mn(e instanceof E?e:xt(e),t)}function Vn(e,t){t===void 0&&(t={}),t=t||{};var r=typeof t.serializeFunctions=="boolean"?t.serializeFunctions:!1,n=typeof t.ignoreUndefined=="boolean"?t.ignoreUndefined:!0;return te(e,r,n)}function Hn(e,t,r,n,a,f){for(var s=Object.assign({allowObjectSmallerThanBufferSize:!0,index:0},f),p=xt(e),h=t,w=0;w<r;w++){var g=p[h]|p[h+1]<<8|p[h+2]<<16|p[h+3]<<24;s.index=h,n[a+w]=Mn(p,s),h=h+g}return h}var wo={Binary:X,Code:_t,DBRef:yt,Decimal128:Vt,Double:It,Int32:Rt,Long:v,UUID:Oe,Map:fe,MaxKey:Ht,MinKey:Yt,ObjectId:V,ObjectID:V,BSONRegExp:vt,BSONSymbol:zt,Timestamp:ue,EJSON:wt,setInternalBufferSize:Cn,serialize:kn,serializeWithBufferAndIndex:Wn,deserialize:Jn,calculateObjectSize:Vn,deserializeStream:Hn,BSONError:B,BSONTypeError:F};const vs=Object.freeze(Object.defineProperty({__proto__:null,BSONError:B,BSONRegExp:vt,BSONSymbol:zt,BSONTypeError:F,BSON_BINARY_SUBTYPE_BYTE_ARRAY:Di,BSON_BINARY_SUBTYPE_COLUMN:$i,BSON_BINARY_SUBTYPE_DEFAULT:An,BSON_BINARY_SUBTYPE_ENCRYPTED:Mi,BSON_BINARY_SUBTYPE_FUNCTION:Li,BSON_BINARY_SUBTYPE_MD5:ji,BSON_BINARY_SUBTYPE_USER_DEFINED:Pi,BSON_BINARY_SUBTYPE_UUID:Fi,BSON_BINARY_SUBTYPE_UUID_NEW:ae,BSON_DATA_ARRAY:Or,BSON_DATA_BINARY:Le,BSON_DATA_BOOLEAN:Ar,BSON_DATA_CODE:Fe,BSON_DATA_CODE_W_SCOPE:xr,BSON_DATA_DATE:Br,BSON_DATA_DBPOINTER:bn,BSON_DATA_DECIMAL128:Ur,BSON_DATA_INT:se,BSON_DATA_LONG:Rr,BSON_DATA_MAX_KEY:Dr,BSON_DATA_MIN_KEY:Lr,BSON_DATA_NULL:De,BSON_DATA_NUMBER:ie,BSON_DATA_OBJECT:Ue,BSON_DATA_OID:br,BSON_DATA_REGEXP:oe,BSON_DATA_STRING:Nr,BSON_DATA_SYMBOL:Tr,BSON_DATA_TIMESTAMP:Ir,BSON_DATA_UNDEFINED:On,BSON_INT32_MAX:vr,BSON_INT32_MIN:Sr,BSON_INT64_MAX:Ri,BSON_INT64_MIN:Ui,Binary:X,Code:_t,DBRef:yt,Decimal128:Vt,Double:It,get EJSON(){return wt},Int32:Rt,Long:v,LongWithoutOverridesClass:xn,get Map(){return fe},MaxKey:Ht,MinKey:Yt,ObjectID:V,ObjectId:V,Timestamp:ue,UUID:Oe,calculateObjectSize:Vn,default:wo,deserialize:Jn,deserializeStream:Hn,serialize:kn,serializeWithBufferAndIndex:Wn,setInternalBufferSize:Cn},Symbol.toStringTag,{value:"Module"}));var tn=function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,f;n<a;n++)(f||!(n in t))&&(f||(f=Array.prototype.slice.call(t,0,n)),f[n]=t[n]);return e.concat(f||Array.prototype.slice.call(t))},mo=function(){function e(t,r,n){this.name=t,this.version=r,this.os=n,this.type="browser"}return e}(),Eo=function(){function e(t){this.version=t,this.type="node",this.name="node",this.os=process.platform}return e}(),_o=function(){function e(t,r,n,a){this.name=t,this.version=r,this.os=n,this.bot=a,this.type="bot-device"}return e}(),vo=function(){function e(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return e}(),So=function(){function e(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return e}(),No=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Oo=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,en=3,bo=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",No]],rn=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Ao(e){return e?nn(e):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new So:typeof navigator<"u"?nn(navigator.userAgent):xo()}function Bo(e){return e!==""&&bo.reduce(function(t,r){var n=r[0],a=r[1];if(t)return t;var f=a.exec(e);return!!f&&[n,f]},!1)}function nn(e){var t=Bo(e);if(!t)return null;var r=t[0],n=t[1];if(r==="searchbot")return new vo;var a=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);a?a.length<en&&(a=tn(tn([],a,!0),Io(en-a.length),!0)):a=[];var f=a.join("."),s=To(e),p=Oo.exec(e);return p&&p[1]?new _o(r,f,s,p[1]):new mo(r,f,s)}function To(e){for(var t=0,r=rn.length;t<r;t++){var n=rn[t],a=n[0],f=n[1],s=f.exec(e);if(s)return a}return null}function xo(){var e=typeof process<"u"&&process.version;return e?new Eo(process.version.slice(1)):null}function Io(e){for(var t=[],r=0;r<e;r++)t.push("0");return t}class ut{constructor(){if(!ut.fetch)throw new Error("DefaultNetworkTransport.fetch must be set before it's used");if(!ut.AbortController)throw new Error("DefaultNetworkTransport.AbortController must be set before it's used")}fetchWithCallbacks(t,r){this.fetch(t).then(async n=>{const a=await n.text(),f={};return n.headers.forEach((s,p)=>{f[p]=s}),{statusCode:n.status,headers:f,body:a}}).then(n=>r.onSuccess(n)).catch(n=>r.onError(n))}async fetch(t){const{timeoutMs:r,url:n,...a}=t,{signal:f,cancelTimeout:s}=this.createTimeoutSignal(r);try{return await ut.fetch(n,{...ut.extraFetchOptions,signal:f,...a})}finally{s()}}createTimeoutSignal(t){if(typeof t=="number"){const r=new ut.AbortController,n=setTimeout(()=>{r.abort()},t);return{signal:r.signal,cancelTimeout:()=>{clearTimeout(n)}}}else return{signal:void 0,cancelTimeout:()=>{}}}}ut.DEFAULT_HEADERS={"Content-Type":"application/json"};const Ro=e=>{},Ee=function(e){return e&&e.Math==Math&&e},Ae=Ee(typeof globalThis=="object"&&globalThis)||Ee(typeof window=="object"&&window)||Ee(typeof self=="object"&&self)||Ee(typeof global=="object"&&global)||function(){return this}()||Function("return this")();Ro(typeof __DEV__<"u"&&__DEV__);ut.fetch=Ae.fetch.bind(Ae);ut.AbortController=Ae.AbortController.bind(Ae);const Yn="3.7.2",Uo=Yn,Lo=typeof atob=="function",Do=typeof btoa=="function",Gt=typeof Buffer=="function",on=typeof TextDecoder=="function"?new TextDecoder:void 0,sn=typeof TextEncoder=="function"?new TextEncoder:void 0,Fo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ee=Array.prototype.slice.call(Fo),_e=(e=>{let t={};return e.forEach((r,n)=>t[r]=n),t})(ee),jo=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,G=String.fromCharCode.bind(String),an=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):(e,t=r=>r)=>new Uint8Array(Array.prototype.slice.call(e,0).map(t)),zn=e=>e.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_"),Gn=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),Xn=e=>{let t,r,n,a,f="";const s=e.length%3;for(let p=0;p<e.length;){if((r=e.charCodeAt(p++))>255||(n=e.charCodeAt(p++))>255||(a=e.charCodeAt(p++))>255)throw new TypeError("invalid character found");t=r<<16|n<<8|a,f+=ee[t>>18&63]+ee[t>>12&63]+ee[t>>6&63]+ee[t&63]}return s?f.slice(0,s-3)+"===".substring(s):f},Fr=Do?e=>btoa(e):Gt?e=>Buffer.from(e,"binary").toString("base64"):Xn,wr=Gt?e=>Buffer.from(e).toString("base64"):e=>{let r=[];for(let n=0,a=e.length;n<a;n+=4096)r.push(G.apply(null,e.subarray(n,n+4096)));return Fr(r.join(""))},Ne=(e,t=!1)=>t?zn(wr(e)):wr(e),Mo=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?G(192|t>>>6)+G(128|t&63):G(224|t>>>12&15)+G(128|t>>>6&63)+G(128|t&63)}else{var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return G(240|t>>>18&7)+G(128|t>>>12&63)+G(128|t>>>6&63)+G(128|t&63)}},$o=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Zn=e=>e.replace($o,Mo),fn=Gt?e=>Buffer.from(e,"utf8").toString("base64"):sn?e=>wr(sn.encode(e)):e=>Fr(Zn(e)),Wt=(e,t=!1)=>t?zn(fn(e)):fn(e),cn=e=>Wt(e,!0),Po=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Co=e=>{switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),r=t-65536;return G((r>>>10)+55296)+G((r&1023)+56320);case 3:return G((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return G((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},qn=e=>e.replace(Po,Co),Kn=e=>{if(e=e.replace(/\s+/g,""),!jo.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let t,r="",n,a;for(let f=0;f<e.length;)t=_e[e.charAt(f++)]<<18|_e[e.charAt(f++)]<<12|(n=_e[e.charAt(f++)])<<6|(a=_e[e.charAt(f++)]),r+=n===64?G(t>>16&255):a===64?G(t>>16&255,t>>8&255):G(t>>16&255,t>>8&255,t&255);return r},jr=Lo?e=>atob(Gn(e)):Gt?e=>Buffer.from(e,"base64").toString("binary"):Kn,Qn=Gt?e=>an(Buffer.from(e,"base64")):e=>an(jr(e),t=>t.charCodeAt(0)),ti=e=>Qn(ei(e)),ko=Gt?e=>Buffer.from(e,"base64").toString("utf8"):on?e=>on.decode(Qn(e)):e=>qn(jr(e)),ei=e=>Gn(e.replace(/[-_]/g,t=>t=="-"?"+":"/")),dr=e=>ko(ei(e)),Wo=e=>{if(typeof e!="string")return!1;const t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},ri=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),ni=function(){const e=(t,r)=>Object.defineProperty(String.prototype,t,ri(r));e("fromBase64",function(){return dr(this)}),e("toBase64",function(t){return Wt(this,t)}),e("toBase64URI",function(){return Wt(this,!0)}),e("toBase64URL",function(){return Wt(this,!0)}),e("toUint8Array",function(){return ti(this)})},ii=function(){const e=(t,r)=>Object.defineProperty(Uint8Array.prototype,t,ri(r));e("toBase64",function(t){return Ne(this,t)}),e("toBase64URI",function(){return Ne(this,!0)}),e("toBase64URL",function(){return Ne(this,!0)})},Jo=()=>{ni(),ii()},Be={version:Yn,VERSION:Uo,atob:jr,atobPolyfill:Kn,btoa:Fr,btoaPolyfill:Xn,fromBase64:dr,toBase64:Wt,encode:Wt,encodeURI:cn,encodeURL:cn,utob:Zn,btou:qn,decode:dr,isValid:Wo,fromUint8Array:Ne,toUint8Array:ti,extendString:ni,extendUint8Array:ii,extendBuiltins:Jo},Vo={relaxed:!1};function oi(e){return wt.serialize(e,Vo)}function si(e){return Array.isArray(e)?e.map(t=>wt.deserialize(t)):wt.deserialize(e)}var mr;(function(e){e.Normal="normal",e.Server="server"})(mr||(mr={}));var st;(function(e){e.NAME="name",e.EMAIL="email",e.PICTURE="picture",e.FIRST_NAME="first_name",e.LAST_NAME="last_name",e.GENDER="gender",e.BIRTHDAY="birthday",e.MIN_AGE="min_age",e.MAX_AGE="max_age"})(st||(st={}));const hn={[st.NAME]:"name",[st.EMAIL]:"email",[st.PICTURE]:"pictureUrl",[st.FIRST_NAME]:"firstName",[st.LAST_NAME]:"lastName",[st.GENDER]:"gender",[st.BIRTHDAY]:"birthday",[st.MIN_AGE]:"minAge",[st.MAX_AGE]:"maxAge"};class ai{constructor(t){if(this.type=mr.Normal,this.identities=[],typeof t=="object"&&t!==null){const{type:r,identities:n,data:a}=t;if(typeof r=="string")this.type=r;else throw new Error("Expected 'type' in the response body");if(Array.isArray(n))this.identities=n.map(f=>{const{id:s,provider_type:p}=f;return{id:s,providerType:p}});else throw new Error("Expected 'identities' in the response body");if(typeof a=="object"&&a!==null){const f=Object.fromEntries(Object.entries(a).map(([s,p])=>s in hn?[hn[s],p]:[s,p]));this.data=si(f)}else throw new Error("Expected 'data' in the response body")}else this.data={}}}class ft{constructor(t,r){this.storage=t,this.keyPart=r}get(t){return this.storage.get(this.keyPart+ft.PART_SEPARATOR+t)}set(t,r){return this.storage.set(this.keyPart+ft.PART_SEPARATOR+t,r)}remove(t){return this.storage.remove(this.keyPart+ft.PART_SEPARATOR+t)}prefix(t){return new ft(this,t)}clear(t=""){return this.storage.clear(this.keyPart+ft.PART_SEPARATOR+t)}addListener(t){return this.storage.addListener(t)}removeListener(t){return this.storage.addListener(t)}}ft.PART_SEPARATOR=":";class Ho{constructor(){this.storage={},this.listeners=new Set}get(t){return t in this.storage?this.storage[t]:null}set(t,r){this.storage[t]=r,this.fireListeners()}remove(t){delete this.storage[t],this.fireListeners()}prefix(t){return new ft(this,t)}clear(t){for(const r of Object.keys(this.storage))(!t||r.startsWith(t))&&delete this.storage[r];this.fireListeners()}addListener(t){this.listeners.add(t)}removeListener(t){this.listeners.delete(t)}fireListeners(){this.listeners.forEach(t=>t())}}const fr="accessToken",cr="refreshToken",hr="profile",ur="providerType";class Yo extends ft{constructor(t,r){super(t,`user(${r})`)}get accessToken(){return this.get(fr)}set accessToken(t){t===null?this.remove(fr):this.set(fr,t)}get refreshToken(){return this.get(cr)}set refreshToken(t){t===null?this.remove(cr):this.set(cr,t)}get profile(){const t=this.get(hr);if(t){const r=new ai;return Object.assign(r,JSON.parse(t)),r}}set profile(t){t?this.set(hr,JSON.stringify(t)):this.remove(hr)}get providerType(){const t=this.get(ur);if(t)return t}set providerType(t){t?this.set(ur,t):this.remove(ur)}}function Er(e){return Object.fromEntries(Object.entries(e).filter(t=>typeof t[1]<"u"))}function zo(e,t){let r="";for(let n=0;n<e;n++)r+=t[Math.floor(Math.random()*t.length)];return r}function fi(e,t=!0){const r=Er(e);return(t&&Object.keys(r).length>0?"?":"")+Object.entries(r).map(([a,f])=>`${a}=${encodeURIComponent(f)}`).join("&")}function Go(e){const t=e[0]==="?"?e.substr(1):e;return Object.fromEntries(t.split("&").filter(r=>r.length>0).map(r=>r.split("=")).map(([r,n])=>[r,decodeURIComponent(n)]))}const Xo=["inspect","callFunction","callFunctionStreaming",...Object.getOwnPropertyNames(Object.prototype)];function Zo(e){for(const t of e)if(typeof t=="object"&&t)for(const[r,n]of Object.entries(t))n===void 0&&delete t[r];return e}function qo(e){return Zo(e).map(r=>typeof r=="object"?oi(r):r)}class je{constructor(t,r={}){this.fetcher=t,this.serviceName=r.serviceName,this.argsTransformation=r.argsTransformation||qo}static create(t,r={}){const n=new je(t,r);return new Proxy(n,{get(a,f,s){if(typeof f=="string"&&Xo.indexOf(f)===-1)return a.callFunction.bind(a,f);{const p=Reflect.get(a,f,s);return typeof p=="function"?p.bind(a):p}}})}async callFunction(t,...r){const n={name:t,arguments:this.argsTransformation?this.argsTransformation(r):r};this.serviceName&&(n.service=this.serviceName);const a=this.fetcher.appRoute;return this.fetcher.fetchJSON({method:"POST",path:a.functionsCall().path,body:n})}callFunctionStreaming(t,...r){const n={name:t,arguments:this.argsTransformation?this.argsTransformation(r):r};this.serviceName&&(n.service=this.serviceName);const a=this.fetcher.appRoute,f=fi({baas_request:Be.encode(JSON.stringify(n))});return this.fetcher.fetchStream({method:"GET",path:a.functionsCall().path+f})}}class Ko{constructor(t,r="local-userpass"){this.fetcher=t,this.providerName=r}async registerUser(t){const r=this.fetcher.appRoute;await this.fetcher.fetchJSON({method:"POST",path:r.emailPasswordAuth(this.providerName).register().path,body:t})}async confirmUser(t){const r=this.fetcher.appRoute;await this.fetcher.fetchJSON({method:"POST",path:r.emailPasswordAuth(this.providerName).confirm().path,body:t})}async resendConfirmationEmail(t){const r=this.fetcher.appRoute;await this.fetcher.fetchJSON({method:"POST",path:r.emailPasswordAuth(this.providerName).confirmSend().path,body:t})}async retryCustomConfirmation(t){const r=this.fetcher.appRoute;await this.fetcher.fetchJSON({method:"POST",path:r.emailPasswordAuth(this.providerName).confirmCall().path,body:t})}async resetPassword(t){const r=this.fetcher.appRoute;await this.fetcher.fetchJSON({method:"POST",path:r.emailPasswordAuth(this.providerName).reset().path,body:t})}async sendResetPasswordEmail(t){const r=this.fetcher.appRoute;await this.fetcher.fetchJSON({method:"POST",path:r.emailPasswordAuth(this.providerName).resetSend().path,body:t})}async callResetPasswordFunction(t,...r){const n=this.fetcher.appRoute;await this.fetcher.fetchJSON({method:"POST",path:n.emailPasswordAuth(this.providerName).resetCall().path,body:{...t,arguments:r}})}}function Qo(){return{path:"/api/client/v2.0",app(e){return{path:this.path+`/app/${e}`,location(){return{path:this.path+"/location"}},authProvider(t){return{path:this.path+`/auth/providers/${t}`,login(){return{path:this.path+"/login"}}}},emailPasswordAuth(t){return{...this.authProvider(t),register(){return{path:this.path+"/register"}},confirm(){return{path:this.path+"/confirm"}},confirmSend(){return{path:this.path+"/confirm/send"}},confirmCall(){return{path:this.path+"/confirm/call"}},reset(){return{path:this.path+"/reset"}},resetSend(){return{path:this.path+"/reset/send"}},resetCall(){return{path:this.path+"/reset/call"}}}},functionsCall(){return{path:this.path+"/functions/call"}}}},auth(){return{path:this.path+"/auth",apiKeys(){return{path:this.path+"/api_keys",key(e){return{path:this.path+`/${e}`,enable(){return{path:this.path+"/enable"}},disable(){return{path:this.path+"/disable"}}}}}},profile(){return{path:this.path+"/profile"}},session(){return{path:this.path+"/session"}},delete(){return{path:this.path+"/delete"}}}}}}var ot={api:Qo};class ts{constructor(t){this.fetcher=t}create(t){return this.fetcher.fetchJSON({method:"POST",body:{name:t},path:ot.api().auth().apiKeys().path,tokenType:"refresh"})}fetch(t){return this.fetcher.fetchJSON({method:"GET",path:ot.api().auth().apiKeys().key(t).path,tokenType:"refresh"})}fetchAll(){return this.fetcher.fetchJSON({method:"GET",tokenType:"refresh",path:ot.api().auth().apiKeys().path})}async delete(t){await this.fetcher.fetchJSON({method:"DELETE",path:ot.api().auth().apiKeys().key(t).path,tokenType:"refresh"})}async enable(t){await this.fetcher.fetchJSON({method:"PUT",path:ot.api().auth().apiKeys().key(t).enable().path,tokenType:"refresh"})}async disable(t){await this.fetcher.fetchJSON({method:"PUT",path:ot.api().auth().apiKeys().key(t).disable().path,tokenType:"refresh"})}}let _r=null;function es(e){_r=e}function ce(){if(_r)return _r;throw new Error("Cannot get environment before it's set")}class lr extends Error{constructor({message:t,code:r}){super(t),this.name="WatchError",this.code=r}}var K;(function(e){e.NEED_DATA="NEED_DATA",e.HAVE_EVENT="HAVE_EVENT",e.HAVE_ERROR="HAVE_ERROR"})(K||(K={}));class rs{constructor(){this._state=K.NEED_DATA,this._error=null,this._textDecoder=new(ce()).TextDecoder,this._buffer="",this._bufferOffset=0,this._eventType="",this._dataBuffer=""}feedBuffer(t){this.assertState(K.NEED_DATA),this._buffer+=this._textDecoder.decode(t,{stream:!0}),this.advanceBufferState()}feedLine(t){if(this.assertState(K.NEED_DATA),t.endsWith(`
`)&&(t=t.substr(0,t.length-1)),t.endsWith("\r")&&(t=t.substr(0,t.length-1)),t.length===0){if(this._dataBuffer.length===0){this._eventType="";return}this._dataBuffer.endsWith(`
`)&&(this._dataBuffer=this._dataBuffer.substr(0,this._dataBuffer.length-1)),this.feedSse({data:this._dataBuffer,eventType:this._eventType}),this._dataBuffer="",this._eventType=""}if(t[0]===":")return;const r=t.indexOf(":"),n=t.substr(0,r);let a=r===-1?"":t.substr(r+1);a.startsWith(" ")&&(a=a.substr(1)),n==="event"?this._eventType=a:n==="data"&&(this._dataBuffer+=a,this._dataBuffer+=`
`)}feedSse(t){this.assertState(K.NEED_DATA);const r=t.data.indexOf("%");if(r!==-1){let n="",a=0;for(let f=r;f!==-1;f=t.data.indexOf("%",a)){n+=t.data.substr(a,f-a);const s=t.data.substr(f,3);s==="%25"?n+="%":s==="%0A"?n+=`
`:s==="%0D"?n+="\r":n+=s,a=f+s.length}n+=t.data.substr(a),t.data=n}if(!t.eventType||t.eventType==="message"){try{const n=wt.parse(t.data);if(typeof n=="object"){this._nextEvent=n,this._state=K.HAVE_EVENT;return}}catch{}this._state=K.HAVE_ERROR,this._error=new lr({message:"server returned malformed event: "+t.data,code:"bad bson parse"})}else if(t.eventType==="error"){this._state=K.HAVE_ERROR,this._error=new lr({message:t.data,code:"unknown"});try{const{error_code:n,error:a}=wt.parse(t.data);if(typeof n!="string"||typeof a!="string")return;this._error=new lr({message:a,code:n})}catch{return}}}get state(){return this._state}nextEvent(){this.assertState(K.HAVE_EVENT);const t=this._nextEvent;return this._state=K.NEED_DATA,this.advanceBufferState(),t}get error(){return this._error}advanceBufferState(){for(this.assertState(K.NEED_DATA);this.state===K.NEED_DATA;){if(this._bufferOffset===this._buffer.length){this._buffer="",this._bufferOffset=0;return}const t=this._buffer.indexOf(`
`,this._bufferOffset);if(t===-1){this._bufferOffset!==0&&(this._buffer=this._buffer.substr(this._bufferOffset,this._buffer.length-this._bufferOffset),this._bufferOffset=0);return}this.feedLine(this._buffer.substr(this._bufferOffset,t-this._bufferOffset)),this._bufferOffset=t+1}}assertState(t){if(this._state!==t)throw Error(`Expected WatchStream to be in state ${t}, but in state ${this._state}`)}}class ns{constructor(t,r,n,a){this.functions=je.create(t,{serviceName:r}),this.databaseName=n,this.collectionName=a,this.serviceName=r,this.fetcher=t}find(t={},r={}){return this.functions.find({database:this.databaseName,collection:this.collectionName,query:t,project:r.projection,sort:r.sort,limit:r.limit})}findOne(t={},r={}){return this.functions.findOne({database:this.databaseName,collection:this.collectionName,query:t,project:r.projection,sort:r.sort})}findOneAndUpdate(t={},r,n={}){return this.functions.findOneAndUpdate({database:this.databaseName,collection:this.collectionName,filter:t,update:r,sort:n.sort,projection:n.projection,upsert:n.upsert,returnNewDocument:n.returnNewDocument})}findOneAndReplace(t={},r,n={}){return this.functions.findOneAndReplace({database:this.databaseName,collection:this.collectionName,filter:t,update:r,sort:n.sort,projection:n.projection,upsert:n.upsert,returnNewDocument:n.returnNewDocument})}findOneAndDelete(t={},r={}){return this.functions.findOneAndReplace({database:this.databaseName,collection:this.collectionName,filter:t,sort:r.sort,projection:r.projection})}aggregate(t){return this.functions.aggregate({database:this.databaseName,collection:this.collectionName,pipeline:t})}count(t={},r={}){return this.functions.count({database:this.databaseName,collection:this.collectionName,query:t,limit:r.limit})}insertOne(t){return this.functions.insertOne({database:this.databaseName,collection:this.collectionName,document:t})}insertMany(t){return this.functions.insertMany({database:this.databaseName,collection:this.collectionName,documents:t})}deleteOne(t={}){return this.functions.deleteOne({database:this.databaseName,collection:this.collectionName,query:t})}deleteMany(t={}){return this.functions.deleteMany({database:this.databaseName,collection:this.collectionName,query:t})}updateOne(t,r,n={}){return this.functions.updateOne({database:this.databaseName,collection:this.collectionName,query:t,update:r,upsert:n.upsert,arrayFilters:n.arrayFilters})}updateMany(t,r,n={}){return this.functions.updateMany({database:this.databaseName,collection:this.collectionName,query:t,update:r,upsert:n.upsert,arrayFilters:n.arrayFilters})}watch({ids:t,filter:r}={}){const a=this.functions.callFunctionStreaming("watch",{database:this.databaseName,collection:this.collectionName,ids:t,filter:r}).then(p=>p[Symbol.asyncIterator]()),f=this.watchImpl(a),s=f.return;return Object.assign(f,{return(p){return a.then(h=>h.return?h.return(p):void 0),s.call(f,p)}})}async*watchImpl(t){const r=new rs,n=t.then(a=>({[Symbol.asyncIterator]:()=>a}));for await(const a of await n)if(a){for(r.feedBuffer(a);r.state==K.HAVE_EVENT;)yield r.nextEvent();if(r.state==K.HAVE_ERROR)throw r.error}}}function is(e,t,r,n){return new ns(e,t,r,n)}function os(e,t,r){return{collection:is.bind(null,e,t,r)}}function ss(e,t="mongo-db"){return{db:os.bind(null,e,t)}}const as="000000000000000000000000";var At;(function(e){e.Active="active",e.LoggedOut="logged-out",e.Removed="removed"})(At||(At={}));var un;(function(e){e.Normal="normal",e.Server="server"})(un||(un={}));class ln{constructor(t){if(this.app=t.app,this.id=t.id,this.storage=new Yo(this.app.storage,this.id),"accessToken"in t&&"refreshToken"in t&&"providerType"in t)this._accessToken=t.accessToken,this._refreshToken=t.refreshToken,this.providerType=t.providerType,this.storage.accessToken=t.accessToken,this.storage.refreshToken=t.refreshToken,this.storage.providerType=t.providerType;else{this._accessToken=this.storage.accessToken,this._refreshToken=this.storage.refreshToken;const r=this.storage.providerType;if(this._profile=this.storage.profile,r)this.providerType=r;else throw new Error("Storage is missing a provider type")}this.fetcher=this.app.fetcher.clone({userContext:{currentUser:this}}),this.apiKeys=new ts(this.fetcher),this.functions=je.create(this.fetcher)}get accessToken(){return this._accessToken}set accessToken(t){this._accessToken=t,this.storage.accessToken=t}get refreshToken(){return this._refreshToken}set refreshToken(t){this._refreshToken=t,this.storage.refreshToken=t}get state(){return this.id in this.app.allUsers?this.refreshToken===null?At.LoggedOut:At.Active:At.Removed}get isLoggedIn(){return this.state===At.Active}get customData(){if(this.accessToken)return this.decodeAccessToken().userData;throw new Error("Cannot read custom data without an access token")}get profile(){if(this._profile)return this._profile.data;throw new Error("A profile was never fetched for this user")}get identities(){if(this._profile)return this._profile.identities;throw new Error("A profile was never fetched for this user")}get deviceId(){if(this.accessToken){const t=this.accessToken.split(".")[1];if(t){const n=JSON.parse(Be.decode(t)).baas_device_id;if(typeof n=="string"&&n!==as)return n}}return null}async refreshProfile(){const t=await this.fetcher.fetchJSON({method:"GET",path:ot.api().auth().profile().path});this._profile=new ai(t),this.storage.profile=this._profile}async logOut(){try{this._refreshToken!==null&&await this.fetcher.fetchJSON({method:"DELETE",path:ot.api().auth().session().path,tokenType:"refresh"})}catch(t){if(!(t instanceof Error)||!t.message.includes("failed to find refresh token"))throw t}finally{this.accessToken=null,this.refreshToken=null}}async linkCredentials(t){const r=await this.app.authenticator.authenticate(t,this);if(this.id!==r.userId){const n=`got user id ${r.userId} expected ${this.id}`;throw new Error(`Link response ment for another user (${n})`)}this.accessToken=r.accessToken,await this.refreshProfile()}async refreshAccessToken(){const t=await this.fetcher.fetchJSON({method:"POST",path:ot.api().auth().session().path,tokenType:"refresh"}),{access_token:r}=t;if(typeof r=="string")this.accessToken=r;else throw new Error("Expected an 'access_token' in the response")}async refreshCustomData(){return await this.refreshAccessToken(),this.customData}addListener(){throw new Error("Not yet implemented")}removeListener(){throw new Error("Not yet implemented")}removeAllListeners(){throw new Error("Not yet implemented")}callFunction(t,...r){return this.functions.callFunction(t,...r)}toJSON(){return{id:this.id,accessToken:this.accessToken,refreshToken:this.refreshToken,profile:this._profile,state:this.state,customData:this.customData}}push(){throw new Error("Not yet implemented")}mongoClient(t){return ss(this.fetcher,t)}decodeAccessToken(){if(this.accessToken){const t=this.accessToken.split(".");if(t.length!==3)throw new Error("Expected an access token with three parts");const r=t[1],n=Be.decode(r),a=JSON.parse(n),{exp:f,iat:s,sub:p,user_data:h={}}=a;if(typeof f!="number")throw new Error("Failed to decode access token 'exp'");if(typeof s!="number")throw new Error("Failed to decode access token 'iat'");return{expires:f,issuedAt:s,subject:p,userData:h}}else throw new Error("Missing an access token")}}class at{constructor(t,r,n){this.providerName=t,this.providerType=r,this.payload=n}static anonymous(){return new at("anon-user","anon-user",{})}static apiKey(t){return new at("api-key","api-key",{key:t})}static emailPassword(t,r){return new at("local-userpass","local-userpass",{username:t,password:r})}static function(t){return new at("custom-function","custom-function",t)}static jwt(t){return new at("custom-token","custom-token",{token:t})}static google(t){return new at("oauth2-google","oauth2-google",at.derivePayload(t))}static derivePayload(t){if(typeof t=="string")throw new Error("`google(<tokenString>)` has been deprecated.  Please use `google(<authCodeObject>).");if(Object.keys(t).length===1){if("authCode"in t||"redirectUrl"in t)return t;if("idToken"in t)return{id_token:t.idToken};throw new Error("Unexpected payload: "+JSON.stringify(t))}else throw new Error("Expected only one property in payload, got "+JSON.stringify(t))}static facebook(t){return new at("oauth2-facebook","oauth2-facebook",t.includes("://")?{redirectUrl:t}:{accessToken:t})}static apple(t){return new at("oauth2-apple","oauth2-apple",t.includes("://")?{redirectUrl:t}:{id_token:t})}}const pn="userIds",gn="deviceId";class fs extends ft{constructor(t,r){super(t,`app(${r})`)}getUserIds(){const t=this.get(pn),r=t?JSON.parse(t):[];if(Array.isArray(r))return[...new Set(r)];throw new Error("Expected the user ids to be an array")}setUserIds(t,r){if(r){const n=this.getUserIds();for(const a of n)t.indexOf(a)===-1&&t.push(a)}this.set(pn,JSON.stringify(t))}removeUserId(t){const n=this.getUserIds().filter(a=>a!==t);this.setUserIds(n,!1)}getDeviceId(){return this.get(gn)}setDeviceId(t){this.set(gn,t)}}const cs="abcdefghijklmnopqrstuvwxyz",hs=100,us={_stitch_client_app_id:"appId",_baas_client_app_id:"appId",_stitch_ua:"userAuth",_baas_ua:"userAuth",_stitch_link:"link",_baas_link:"link",_stitch_error:"error",_baas_error:"error",_stitch_state:"state",_baas_state:"state"};class Tt{constructor(t,r=ce().openWindow){this.storage=t.prefix("oauth2"),this.openWindow=r}static parseRedirectLocation(t){const r=Go(t),n={};for(const[a,f]of Object.entries(us)){const s=r[a];s&&(n[f]=s)}return n}static handleRedirect(t,r=ce().defaultStorage){const n=Tt.parseRedirectLocation(t),{state:a,error:f}=n;if(typeof a=="string"){const s=r.prefix("oauth2");Tt.getStateStorage(s,a).set("result",JSON.stringify(n))}else throw f?new Error(`Failed to handle OAuth 2.0 redirect: ${f}`):new Error("Failed to handle OAuth 2.0 redirect.")}static decodeAuthInfo(t){const r=(t||"").split("$");if(r.length===4){const[n,a,f,s]=r;return{accessToken:n,refreshToken:a,userId:f,deviceId:s}}else throw new Error("Failed to decode 'authInfo' into ids and tokens")}static getStateStorage(t,r){return t.prefix(`state(${r})`)}openWindowAndWaitForRedirect(t,r){const n=Tt.getStateStorage(this.storage,r);return new Promise((a,f)=>{let s=null,p;const h=()=>{const w=n.get("result");if(w){const g=JSON.parse(w);n.removeListener(h),n.clear();try{s&&(clearInterval(p),s.close())}catch(u){console.warn(`Failed closing redirect window: ${u}`)}finally{a(g)}}};n.addListener(h),s=this.openWindow(t),p=setInterval(()=>{if(!s)clearInterval(p);else if(s.closed){clearInterval(p),n.removeListener(h);const w=new Error("Window closed");f(w)}},hs)})}generateState(){return zo(12,cs)}}const yn="x-baas-location";class ls{constructor(t,r,n){this.fetcher=t,this.oauth2=new Tt(r),this.getDeviceInformation=n}async authenticate(t,r){const n=this.getDeviceInformation(),a=typeof r=="object";if(t.providerType.startsWith("oauth2")&&typeof t.payload.redirectUrl=="string"){const f=this.oauth2.generateState(),s=await this.getLogInUrl(t,a,{state:f,redirect:t.payload.redirectUrl,providerRedirectHeader:a?!0:void 0,device:a?void 0:n.encode()});if(a){const h=(await this.fetcher.fetch({method:"GET",url:s,tokenType:a?"access":"none",user:r,mode:"cors",credentials:"include"})).headers.get(yn);if(h)return this.openWindowAndWaitForAuthResponse(h,f);throw new Error(`Missing ${yn} header`)}else return this.openWindowAndWaitForAuthResponse(s,f)}else{const f=await this.getLogInUrl(t,a),s=await this.fetcher.fetchJSON({method:"POST",url:f,body:{...t.payload,options:{device:n.toJSON()}},tokenType:a?"access":"none",user:r}),{user_id:p,access_token:h,refresh_token:w=null,device_id:g}=s;if(typeof p!="string")throw new Error("Expected a user id in the response");if(typeof h!="string")throw new Error("Expected an access token in the response");if(typeof w!="string"&&w!==null)throw new Error("Expected refresh token to be a string or null");if(typeof g!="string")throw new Error("Expected device id to be a string");return{userId:p,accessToken:h,refreshToken:w,deviceId:g}}}async getLogInUrl(t,r=!1,n={}){const f=this.fetcher.appRoute.authProvider(t.providerName).login(),s=fi({link:r?"true":void 0,...n});return await this.fetcher.locationUrl+f.path+s}async openWindowAndWaitForAuthResponse(t,r){const n=await this.oauth2.openWindowAndWaitForRedirect(t,r);return Tt.decodeAuthInfo(n.userAuth)}}class Te extends Error{constructor(t,r,n,a,f,s,p){const h=a?`status ${n} ${a}`:`status ${n}`;typeof f=="string"?super(`Request failed (${t} ${r}): ${f} (${h})`):super(`Request failed (${t} ${r}): (${h})`),this.method=t,this.url=r,this.statusText=a,this.statusCode=n,this.error=f,this.errorCode=s,this.link=p}static async fromRequestAndResponse(t,r){var n;const{url:a,method:f}=t,{status:s,statusText:p}=r;if(!((n=r.headers.get("content-type"))===null||n===void 0)&&n.startsWith("application/json")){const h=await r.json();if(typeof h=="object"&&h){const{error:w,error_code:g,link:u}=h;return new Te(f,a,s,p,typeof w=="string"?w:void 0,typeof g=="string"?g:void 0,typeof u=="string"?u:void 0)}}return new Te(f,a,s,p)}}function ps(e){if(typeof e!="object"||e===null)throw new Error("Expected a non-null object");if(Symbol.asyncIterator in e)return e;if("getReader"in e){const t=e;return{[Symbol.asyncIterator](){const r=t.getReader();return{next(){return r.read()},async return(){return await r.cancel(),{done:!0,value:null}}}}}}else throw new Error("Expected an AsyncIterable or a ReadableStream")}class Ct{constructor({appId:t,transport:r,userContext:n,locationUrlContext:a}){this.appId=t,this.transport=r,this.userContext=n,this.locationUrlContext=a}static buildAuthorizationHeader(t,r){if(!t||r==="none")return{};if(r==="access")return{Authorization:`Bearer ${t.accessToken}`};if(r==="refresh")return{Authorization:`Bearer ${t.refreshToken}`};throw new Error(`Unexpected token type (${r})`)}static buildBody(t){if(t){if(typeof t=="object"&&t!==null)return JSON.stringify(oi(t));if(typeof t=="string")return t;throw console.log("body is",t),new Error("Unexpected type of body")}else return}static buildJsonHeader(t){return t&&t.length>0?{"Content-Type":"application/json"}:{}}clone(t){return new Ct({appId:this.appId,transport:this.transport,userContext:this.userContext,locationUrlContext:this.locationUrlContext,...t})}async fetch(t){const{path:r,url:n,tokenType:a="access",user:f=this.userContext.currentUser,...s}=t;if(typeof r=="string"&&typeof n=="string")throw new Error("Use of 'url' and 'path' mutually exclusive");if(typeof r=="string"){const p=await this.locationUrlContext.locationUrl+r;return this.fetch({...t,path:void 0,url:p})}else if(typeof n=="string"){const p=await this.transport.fetch({...s,url:n,headers:{...Ct.buildAuthorizationHeader(f,a),...t.headers}});if(p.ok)return p;if(f&&p.status===401&&a==="access")return await f.refreshAccessToken(),this.fetch({...t,user:f});throw f&&p.status===401&&a==="refresh"&&(f.accessToken=null,f.refreshToken=null),await Te.fromRequestAndResponse(t,p)}else throw new Error("Expected either 'url' or 'path'")}async fetchJSON(t){const{body:r}=t,n=Ct.buildBody(r),a=Ct.buildJsonHeader(n),f=await this.fetch({...t,body:n,headers:{Accept:"application/json",...a,...t.headers}}),s=f.headers.get("content-type");if(s!=null&&s.startsWith("application/json")){const p=await f.json();return si(p)}else{if(s===null)return null;throw new Error(`Expected JSON response, got "${s}"`)}}async fetchStream(t){const{body:r}=await this.fetch({...t,headers:{Accept:"text/event-stream",...t.headers}});return ps(r)}get appRoute(){return ot.api().app(this.appId)}get locationUrl(){return this.locationUrlContext.locationUrl}}const gs="deviceId";var wn;(function(e){e.DEVICE_ID="deviceId",e.APP_ID="appId",e.APP_VERSION="appVersion",e.PLATFORM="platform",e.PLATFORM_VERSION="platformVersion",e.SDK_VERSION="sdkVersion"})(wn||(wn={}));class ys{constructor({appId:t,appVersion:r,deviceId:n}){this.sdkVersion="2.0.0";const a=ce();this.platform=a.platform,this.platformVersion=a.platformVersion,this.appId=t,this.appVersion=r,this.deviceId=n}encode(){const t=Er(this);return Be.encode(JSON.stringify(t))}toJSON(){return Er(this)}}const ws="https://realm.mongodb.com";class Et{constructor(t){this.users=[],this._locationUrl=null;const r=typeof t=="string"?{id:t}:t;if(typeof r=="object"&&typeof r.id=="string")this.id=r.id;else throw new Error("Missing an Atlas App Services app-id");this.baseUrl=r.baseUrl||ws,r.skipLocationRequest&&(this._locationUrl=Promise.resolve(this.baseUrl)),this.localApp=r.app;const{storage:n,transport:a=new ut}=r;this.fetcher=new Ct({appId:this.id,userContext:this,locationUrlContext:this,transport:a}),this.emailPasswordAuth=new Ko(this.fetcher);const f=n||ce().defaultStorage;this.storage=new fs(f,this.id),this.authenticator=new ls(this.fetcher,f,()=>this.deviceInformation);try{this.hydrate()}catch(s){this.storage.clear(),console.warn("Realm app hydration failed:",s instanceof Error?s.message:s)}}static getApp(t){if(t in Et.appCache)return Et.appCache[t];{const r=new Et(t);return Et.appCache[t]=r,r}}switchUser(t){const r=this.users.findIndex(a=>a===t);if(r===-1)throw new Error("The user was never logged into this app");const[n]=this.users.splice(r,1);this.users.unshift(n)}async logIn(t,r=!0){const n=await this.authenticator.authenticate(t),a=this.createOrUpdateUser(n,t.providerType);this.switchUser(a),r&&await a.refreshProfile(),this.storage.setUserIds(this.users.map(s=>s.id),!0);const f=n.deviceId;return f&&f!=="000000000000000000000000"&&this.storage.set(gs,f),a}async removeUser(t){const r=this.users.findIndex(n=>n===t);if(r===-1)throw new Error("The user was never logged into this app");this.users.splice(r,1),await t.logOut(),this.storage.remove(`user(${t.id}):profile`),this.storage.removeUserId(t.id)}async deleteUser(t){await this.fetcher.fetchJSON({method:"DELETE",path:ot.api().auth().delete().path}),await this.removeUser(t)}addListener(){throw new Error("Not yet implemented")}removeListener(){throw new Error("Not yet implemented")}removeAllListeners(){throw new Error("Not yet implemented")}get currentUser(){const t=this.users.filter(r=>r.state===At.Active);return t.length===0?null:t[0]}get allUsers(){return Object.fromEntries(this.users.map(t=>[t.id,t]))}get locationUrl(){if(!this._locationUrl){const t=ot.api().app(this.id).location().path;this._locationUrl=this.fetcher.fetchJSON({method:"GET",url:this.baseUrl+t,tokenType:"none"}).then(r=>{if(typeof r!="object")throw new Error("Expected response body be an object");return r}).then(({hostname:r})=>{if(typeof r!="string")throw new Error("Expected response to contain a 'hostname'");return r}).catch(r=>{throw this._locationUrl=null,r})}return this._locationUrl}get deviceInformation(){const t=this.storage.getDeviceId(),r=typeof t=="string"&&t!=="000000000000000000000000"?new V(t):void 0;return new ys({appId:this.localApp?this.localApp.name:void 0,appVersion:this.localApp?this.localApp.version:void 0,deviceId:r})}createOrUpdateUser(t,r){const n=this.users.find(a=>a.id===t.userId);if(n)return n.accessToken=t.accessToken,n.refreshToken=t.refreshToken,n;{if(!t.refreshToken)throw new Error("No refresh token in response from server");const a=new ln({app:this,id:t.userId,accessToken:t.accessToken,refreshToken:t.refreshToken,providerType:r});return this.users.unshift(a),a}}hydrate(){const t=this.storage.getUserIds();this.users=t.map(r=>new ln({app:this,id:r}))}}Et.appCache={};Et.Credentials=at;function Ss(e){return Et.getApp(e)}const ds=e=>{},ve=function(e){return e&&e.Math==Math&&e},Jt=ve(typeof globalThis=="object"&&globalThis)||ve(typeof window=="object"&&window)||ve(typeof self=="object"&&self)||ve(typeof global=="object"&&global)||function(){return this}()||Function("return this")();ds(typeof __DEV__<"u"&&__DEV__);class ms{constructor(){if(typeof Jt.localStorage=="object")this.global=Jt;else throw new Error("Cannot use LocalStorage without a global localStorage object")}get(t){return this.global.localStorage.getItem(t)}set(t,r){return this.global.localStorage.setItem(t,r)}remove(t){return this.global.localStorage.removeItem(t)}prefix(t){return new ft(this,t)}clear(t){const r=[];for(let n=0;n<this.global.localStorage.length;n++){const a=this.global.localStorage.key(n);a&&(!t||a.startsWith(t))&&r.push(a)}for(const n of r)this.global.localStorage.removeItem(n)}addListener(t){return this.global.addEventListener("storage",t)}removeListener(t){return this.global.removeEventListener("storage",t)}}const Mt=Ao(),Es="localStorage"in Jt?ms:Ho;function _s(e){return typeof Jt.open=="function"?Jt.open(e):(console.log(`Please open ${e}`),null)}const ci={defaultStorage:new Es().prefix("realm-web"),openWindow:_s,platform:(Mt==null?void 0:Mt.name)||"web",platformVersion:(Mt==null?void 0:Mt.version)||"0.0.0",TextDecoder};es(ci);function Ns(e=Jt.location,t=ci.defaultStorage){try{const r=e.hash.substr(1);Tt.handleRedirect(r,t)}catch(r){console.warn(r)}}export{Et as App,vs as BSON,at as Credentials,ws as DEFAULT_BASE_URL,ms as LocalStorage,Te as MongoDBRealmError,ln as User,At as UserState,un as UserType,Ss as getApp,ce as getEnvironment,Ns as handleAuthRedirect,es as setEnvironment};
